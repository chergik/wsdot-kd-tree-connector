<!DOCTYPE html>
<!-- saved from url=(0050)http://www.movable-type.co.uk/scripts/latlong.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style type="text/css">.gm-style .gm-style-mtc label,.gm-style .gm-style-mtc div{font-weight:400}</style><link type="text/css" rel="stylesheet" href="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/css"><style type="text/css">.gm-style .gm-style-cc span,.gm-style .gm-style-cc a,.gm-style .gm-style-mtc div{font-size:10px}</style><style type="text/css">@media print {  .gm-style .gmnoprint, .gmnoprint {    display:none  }}@media screen {  .gm-style .gmnoscreen, .gmnoscreen {    display:none  }}</style><style type="text/css">.gm-style{font-family:Roboto,Arial,sans-serif;font-size:11px;font-weight:400;text-decoration:none}</style>
    <meta charset="utf-8">
    <title>Calculate distance and bearing between two Latitude/Longitude points using haversine formula in JavaScript</title>
    <meta name="author" content="Chris Veness, www.movable-type.co.uk">
    <meta name="keywords" content="latitude longitude distance bearing points earth haversine great circle rhumb">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.2/normalize.min.css">
    <link rel="stylesheet" href="http://www.movable-type.co.uk/css/base.css">
    <link rel="stylesheet" href="http://www.movable-type.co.uk/css/eb-garamond/stylesheet.css">
    <link rel="stylesheet" href="http://www.movable-type.co.uk/css/mtl.css">
    <link rel="stylesheet" href="http://www.movable-type.co.uk/css/prettify.css">
    <style>
        body                { max-width: 64em; }
        input               { text-align: right; width: 6em; }
        input[type="radio"] { width: auto; vertical-align: baseline; }
        a                   { cursor: pointer; }
        figcaption          { font-size: 0.8em; font-style: italic; text-align: center; }
        form ul.list        { list-style: inherit; } /* an actual list to appear within a form! */
        fieldset            { padding: 0 2em; }
        input               { background-color: #f0f0f0; }
        output              { color: #000099; font-weight: bold; }
        .inputs             { float: left; margin: 1em 2em 0 0; }
        .outputs            { margin: 1em 2em 0 0; }
        .map                { display: none; height: 480px; width: 480px; }
        .radicand           { border-top: solid 1px #cccccc; }
        pre.prettyprint     { border: none; }
        .margin-l-0         { margin-left: 0; }
        .label              { color: #666666; font-style: italic; }
        aside {
            border-top: 4px solid #cccccc;
            border-bottom: 4px solid #cccccc;
            float: right;
            font-size: 0.85em;
            line-height: 1.4;
            margin-left: 1em;
            padding: 0.5em;
            width: 21em;
        }
        code.prettyprint {
            display: block;
            font-size: 0.8em;
            line-height: 1;;
            margin-left: 2.5em;
            padding-bottom: 0.4em;
            text-indent: -2.5em;
        }

        @media screen and (max-width: 800px) {
            .formula { font-size: 0.9em; /* Times a bit strange on Android? */ }
            figure img { width: 120px; }
        }
    </style>
    <!--[if lt IE 9]> <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script> <![endif]-->
    <script src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/js"> </script><style type="text/css"></style><script src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/main.js"></script>
    <script src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/jquery.min.js"></script>
    <script src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mtl.js">/* MTL utils */</script>
    <script src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/prettify.js">/* google-code-prettify */</script>
    <script src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/jquery.cookie.js">/* jquery cookies */</script>
    <script src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/latlon-spherical.js">/* Latitude/Longitude formulae JavaScript implementation */</script>
    <script src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/dms.js">/* Geodesy representation conversions */</script>
    <script>
        'use strict';

        var maps = { // note we have to track overlay items ourselves
            orthoDist: { map:null, geodesic:true,  overlay: { marker1:null, marker2:null, path:null } },
            orthoDest: { map:null, geodesic:true,  overlay: { marker1:null, marker2:null, path:null } },
            rhumbDist: { map:null, geodesic:false, overlay: { marker1:null, marker2:null, path:null } },
            rhumbDest: { map:null, geodesic:false, overlay: { marker1:null, marker2:null, path:null } }
        };

        function drawPath(lat1, lon1, lat2, lon2, m) {
            google.maps.event.trigger(m.map, 'resize');  // Gaaaaaah!

            // clear current overlays
            if (m.overlay.marker1) { m.overlay.marker1.setMap(null); m.overlay.marker1 = null; }
            if (m.overlay.marker2) { m.overlay.marker2.setMap(null); m.overlay.marker1 = null; }
            if (m.overlay.path)    { m.overlay.path.setMap(null);    m.overlay.path = null; }

            // if supplied lat/long are all valid numbers, draw the path
            if (!isNaN(lat1+lon1+lat2+lon2)) {
                var p1 = new google.maps.LatLng(lat1, lon1);
                var p2 = new google.maps.LatLng(lat2, lon2);
                var sw = new google.maps.LatLng(Math.min(lat1, lat2), Math.min(lon1, lon2));
                var ne = new google.maps.LatLng(Math.max(lat1, lat2), Math.max(lon1, lon2));
                var bnds = new google.maps.LatLngBounds(sw, ne);
                m.map.fitBounds(bnds);
                m.overlay.marker1 = new google.maps.Marker({ map:m.map, position:p1, title:'Point 1'});
                m.overlay.marker2 = new google.maps.Marker({ map:m.map, position:p2, title:'Point 2'});
                m.overlay.path = new google.maps.Polyline({ map:m.map, path:[p1, p2], strokeColor:'#990000', geodesic:m.geodesic});
            }
        }

        $(document).ready(function() {
            // show source code
            $.get('js/geodesy/latlon-spherical.js', function(data) {
                var src = data.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') // replace &, <, >
                $('#latlon-src').html(src);
                prettyPrint();
            });
            $.get('js/geodesy/dms.js', function(data) {
                var src = data.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') // replace &, <, >
                $('#dms-src').html(src);
                prettyPrint();
            });

            // has user made d/dms display preference?
            var degFmt = $.cookie('latlon-degree-format') || 'dms';
            // show current preference
            $('#deg-format-'+degFmt).attr('checked', true);

            // initialise maps
            var mapOptions = {
                zoom: 0,
                center: new google.maps.LatLng(0, 0),
                mapTypeId: google.maps.MapTypeId.HYBRID,
                mapTypeControlOptions: {
                    style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
                },
                navigationControlOptions: {
                    style: google.maps.NavigationControlStyle.SMALL
                },
                scaleControl: true
            };
            maps.orthoDist.map = new google.maps.Map($('#map-ortho-dist-canvas')[0], mapOptions);
            maps.orthoDest.map = new google.maps.Map($('#map-ortho-dest-canvas')[0], mapOptions);
            maps.rhumbDist.map = new google.maps.Map($('#map-rhumb-dist-canvas')[0], mapOptions);
            maps.rhumbDest.map = new google.maps.Map($('#map-rhumb-dest-canvas')[0], mapOptions);

            // ---- listeners for orthodrome distance / bearings / midpoint between two points

            // listener for updated values
            $('#ortho-dist input').change( function() {
                var lat1 = Dms.parseDMS($('#ortho-dist .lat1').val());
                var lon1 = Dms.parseDMS($('#ortho-dist .lon1').val());
                var lat2 = Dms.parseDMS($('#ortho-dist .lat2').val());
                var lon2 = Dms.parseDMS($('#ortho-dist .lon2').val());

                // calculate distance, bearing, mid-point
                var p1 = LatLon(lat1, lon1);
                var p2 = LatLon(lat2, lon2);
                var dist = p1.distanceTo(p2);
                var brng1 = p1.bearingTo(p2);
                var brng2 = p1.finalBearingTo(p2);
                var pMid = p1.midpointTo(p2);

                // display results
                $('#ortho-dist .result-dist').html((dist/1000).toPrecisionDecimal(4)); // in km
                $('#ortho-dist .result-brng1').html(Dms.toBrng(brng1, degFmt));
                $('#ortho-dist .result-brng2').html(Dms.toBrng(brng2, degFmt));
                $('#ortho-dist .result-midpt').html(pMid.toString(degFmt));

                // show path on map
                if ($('#map-ortho-dist-canvas').is(':visible')) {
                    drawPath(p1.lat, p1.lon, p2.lat, p2.lon, maps.orthoDist);
                }
            });
            $('#ortho-dist .lat1').trigger('change'); // initial calculation

            // listener for map toggle
            $('#ortho-dist .toggle-map a').click( function() {
                $('#ortho-dist .toggle-map').toggle(); // 'see on map' text
                $('#ortho-dist .map').toggle();        // the map itself

                $('#ortho-dist .lat1').trigger('change'); // to invoke drawPath()
            });

            // ---- listeners for orthodrome destination point from start point / bearing / distance

            // listener for updated values
            $('#ortho-dest input').change( function() {
                var lat1 = Dms.parseDMS($('#ortho-dest .lat1').val());
                var lon1 = Dms.parseDMS($('#ortho-dest .lon1').val());
                var dist = $('#ortho-dest .dist').val() * 1000; // convert km to metres
                var brng = Dms.parseDMS($('#ortho-dest .brng').val());

                // calculate destination point, final bearing
                var p1 = LatLon(lat1, lon1);
                var p2 = p1.destinationPoint(dist, brng);
                var brngFinal = p1.finalBearingTo(p2);

                // display results
                $('#ortho-dest .result-point').html(p2.toString(degFmt));
                $('#ortho-dest .result-brng').html(Dms.toBrng(brngFinal,degFmt));

                // show path on map
                if ($('#map-ortho-dest-canvas').is(':visible')) {
                    drawPath(p1.lat, p1.lon, p2.lat, p2.lon, maps.orthoDest);
                }
            });
            $('#ortho-dest .lat1').trigger('change'); // initial calculation

            // listener for map toggle
            $('#ortho-dest .toggle-map a').click( function() {
                $('#ortho-dest .toggle-map').toggle();
                $('#ortho-dest .map').toggle();

                $('#ortho-dest .lat1').trigger('change'); // to invoke drawPath()
            });

            // ---- listeners for intersection of two paths

            // listener for updated values
            $('#intersect input').change( function() {
                var lat1 = Dms.parseDMS($('#intersect .lat1').val());
                var lon1 = Dms.parseDMS($('#intersect .lon1').val());
                var lat2 = Dms.parseDMS($('#intersect .lat2').val());
                var lon2 = Dms.parseDMS($('#intersect .lon2').val());

                // calculate intersection point
                var p1 = LatLon(lat1, lon1);
                var p2 = LatLon(lat2, lon2);
                var brng1 = Dms.parseDMS($('#intersect .brng1').val());
                var brng2 = Dms.parseDMS($('#intersect .brng2').val());
                var pInt = LatLon.intersection(p1, brng1, p2, brng2);

                // display result
                $('#intersect .result-point').html(pInt==null ? '[ambiguous]' : pInt.toString(degFmt));
            });
            $('#intersect .lat1').trigger('change'); // initial calculation

            // ---- listeners for rhumb lines distance

            // listener for updated values
            $('#rhumb-dist input').change( function() {
                var lat1 = Dms.parseDMS($('#rhumb-dist .lat1').val());
                var lon1 = Dms.parseDMS($('#rhumb-dist .lon1').val());
                var lat2 = Dms.parseDMS($('#rhumb-dist .lat2').val());
                var lon2 = Dms.parseDMS($('#rhumb-dist .lon2').val());

                // calculate distance, bearing, mid-point
                var p1 = LatLon(lat1, lon1);
                var p2 = LatLon(lat2, lon2);
                var dist = p1.rhumbDistanceTo(p2);
                var brng = p1.rhumbBearingTo(p2);
                var pMid = p1.rhumbMidpointTo(p2);

                // display results
                $('#rhumb-dist .result-dist').html((dist/1000).toPrecisionDecimal(4)); // in km
                $('#rhumb-dist .result-brng').html(Dms.toBrng(brng, degFmt));
                $('#rhumb-dist .result-midpt').html(pMid.toString(degFmt));

                // show path on map
                if ($('#map-rhumb-dist-canvas').is(':visible')) {
                    drawPath(p1.lat, p1.lon, p2.lat, p2.lon, maps.rhumbDist);
                }
            });
            $('#rhumb-dist .lat1').trigger('change'); // initial calculation

            // listener for map toggle
            $('#rhumb-dist .toggle-map a').click( function() {
                $('#rhumb-dist .toggle-map').toggle();
                $('#rhumb-dist .map').toggle();

                $('#rhumb-dist .lat1').trigger('change'); // to invoke drawPath()
            });

            // ---- listeners for rhumb lines destination

            // listener for updated values
            $('#rhumb-dest input').change( function() {
                var lat1 = Dms.parseDMS($('#rhumb-dest .lat1').val());
                var lon1 = Dms.parseDMS($('#rhumb-dest .lon1').val());
                var brng = Dms.parseDMS($('#rhumb-dest .brng').val());
                var dist = $('#rhumb-dest .dist').val() * 1000; // convert km to metres

                // calculate destination point
                var p1 = LatLon(lat1, lon1);
                var p2 = p1.rhumbDestinationPoint(dist, brng);

                // display results
                $('#rhumb-dest .result-point').html(p2.toString(degFmt));

                // show path on map
                if ($('#map-rhumb-dest-canvas').is(':visible')) {
                    drawPath(p1.lat, p1.lon, p2.lat, p2.lon, maps.rhumbDest);
                }
            });
            $('#rhumb-dest .lat1').trigger('change'); // initial calculation

            // listener for map toggle
            $('#rhumb-dest .toggle-map a').click( function() {
                $('#rhumb-dest .toggle-map').toggle();
                $('#rhumb-dest .map').toggle();

                $('#rhumb-dest .lat1').trigger('change'); // to invoke drawPath()
            });

            // deg-min-sec / decimal degrees conversion
            $('#latDMS').change( function() { var lat = Dms.parseDMS($('#latDMS').val()); $('#latDM').val(Dms.toLat(lat,'dm',3)); $('#latD').val(Dms.toLat(lat,'d',5)); });
            $('#lonDMS').change( function() { var lon = Dms.parseDMS($('#lonDMS').val()); $('#lonDM').val(Dms.toLon(lon,'dm',3)); $('#lonD').val(Dms.toLon(lon,'d',5)); });
            $('#latDM').change( function() { var lat = Dms.parseDMS($('#latDM').val()); $('#latDMS').val(Dms.toLat(lat,'dms',1)); $('#latD').val(Dms.toLat(lat,'d',5)); });
            $('#lonDM').change( function() { var lon = Dms.parseDMS($('#lonDM').val()); $('#lonDMS').val(Dms.toLon(lon,'dms',1)); $('#lonD').val(Dms.toLon(lon,'d',5)); });
            $('#latD').change( function() { var lat = Dms.parseDMS($('#latD').val()); $('#latDMS').val(Dms.toLat(lat,'dms',1)); $('#latDM').val(Dms.toLat(lat,'dm',3)); });
            $('#lonD').change( function() { var lon = Dms.parseDMS($('#lonD').val()); $('#lonDMS').val(Dms.toLon(lon,'dms',1)); $('#lonDM').val(Dms.toLon(lon,'dm',3)); });

            // listener for display of bearings to user's preference
            $('input[name="deg-format"]').change(function() {
                // record preference in cookie
                $.cookie('latlon-degree-format', degFmt = $(this).val());

                // trigger recalculations with new format
                $('#ortho-dist .lat1').trigger('change');
                $('#ortho-dest .lat1').trigger('change');
                $('#intersect  .lat1').trigger('change');
                $('#rhumb-dist .lat1').trigger('change');
                $('#rhumb-dest .lat1').trigger('change');
            });

            // ---- url query arguments for distance calculation

            var from = getQueryArg('from'), to = getQueryArg('to');
            if (from && to) {
                from = from.split(',');
                to = to.split(',');
                $('#ortho-dist .lat1').val(from[0]);
                $('#ortho-dist .lon1').val(from[1]);
                $('#ortho-dist .lat2').val(to[0]);
                $('#ortho-dist .lon2').val(to[1]);
                //$('#ortho-dist .toggle-map a').trigger('click'); why no work?
                $('#ortho-dist .toggle-map').toggle(); // 'see on map' text
                $('#ortho-dist .map').toggle();        // the map itself
                $('#ortho-dist .lat1').trigger('change'); // to invoke drawPath()
            }

        });

        /**
         * Returns specified argument from query string.
         *
         * @params  {string} key - Argument to be returned.
         * @returns {string} Value of key ('' for ?arg=, null for ?arg, undefined if not present).
         */
        function getQueryArg(key) {
            // look for key prefixed by ?/&/;, (optionally) suffixed
            // by =val (using lazy match), followed by &/;/# or EOS
            var re = new RegExp('[?&;]'+key+'(=(.*?))?([&;#]|$)');
            var results = re.exec(location.search);
            if (results == null) return undefined; // not found
            if (results[2] == undefined) return null; // ?key without '='
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        function getQueryArgSplitFor(key) {
            var srch = location.search.substring(1);  // lose the initial '?'
            var args = srch.split(/[&;]/);            // list of field=value pairs
            for (var i=0; i<args.length; i++) {       // for each arg
                var arg = args[i].split('=');         // split at '='
                if (arg[0] == key) {                  // arg we're looking for?
                    if (arg.length == 1) return null; // ?key without '='
                    return decodeURIComponent(arg[1].replace(/\+/g, ' '));
                }
            }
            return undefined;                         // not found
        }


        /** Extend Number object with method to format significant digits of a number,
         *  using decimal rather than exponential (scientific) notation */
        if (typeof Number.prototype.toPrecisionDecimal == 'undefined') {
            Number.prototype.toPrecisionDecimal = function(precision) {

                // use standard toPrecision method
                var n = this.toPrecision(precision);

                // ... but replace +ve exponential format with trailing zeros
                n = n.replace(/(.+)e\+(.+)/, function(n, sig, exp) {
                    sig = sig.replace(/\./, '');       // remove decimal from significand
                    var l = sig.length - 1;
                    while (exp-- > l) sig = sig + '0'; // append zeros from exponent
                    return sig;
                });

                // ... and replace -ve exponential format with leading zeros
                n = n.replace(/(.+)e-(.+)/, function(n, sig, exp) {
                    sig = sig.replace(/\./, '');       // remove decimal from significand
                    while (exp-- > 1) sig = '0' + sig; // prepend zeros from exponent
                    return '0.' + sig;
                });

                return n;
            }
        }
    </script>
<script type="text/javascript" charset="UTF-8" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/common.js"></script><script type="text/javascript" charset="UTF-8" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/map.js"></script><script type="text/javascript" charset="UTF-8" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/util.js"></script><script type="text/javascript" charset="UTF-8" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/onion.js"></script><script type="text/javascript" charset="UTF-8" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/controls.js"></script><script type="text/javascript" charset="UTF-8" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/stats.js"></script><script type="text/javascript" charset="UTF-8" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/marker.js"></script></head>

<body>

<header> <a href="http://www.movable-type.co.uk/"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mtl.gif" alt="MTL logo"></a>
  <h1>Movable Type Scripts</h1>
  <hr>
  <h2>Calculate distance, bearing and more between Latitude/Longitude points</h2>
</header>


<main>
<p>This page presents a variety of calculations for latitude/longitude points, with the formulæ and
    code fragments for implementing them.</p>
<p>All these formulæ are for calculations on the basis of a spherical earth  (ignoring ellipsoidal
    effects) – which is accurate enough<sup><a href="http://www.movable-type.co.uk/scripts/latlong.html#ellipsoid" title="see notes">*</a></sup> for
    most purposes… [In fact, the earth is very slightly ellipsoidal; using a spherical model gives
    errors typically up to 0.3% – see notes for further details].</p>

<form name="ortho-dist" id="ortho-dist">
    <fieldset><legend>Great-circle distance between two points</legend>
        <p>Enter the co-ordinates into the text boxes to try out the calculations. A variety of
            formats are accepted, principally:</p>
        <ul class="list">
            <li>deg-min-sec suffixed with N/S/E/W (e.g. 40°44′55″N, 73 59 11W), or</li>
            <li>signed decimal degrees without compass direction, where negative indicates
                west/south (e.g. 40.7486, -73.9864):
            </li>
        </ul>
        <table class="inputs">
            <tbody><tr>
                <td>Point 1:</td>
                <td>
                    <input type="text" name="lat1" class="lat1" value="50 03 59N" placeholder="Lat 1 (°N/S)" title="Lat 1 (°N/S)" required=""> ,
                    <input type="text" name="lon1" class="lon1" value="005 42 53W" placeholder="Lon 1 (°E/W)" title="Lon 1 (°E/W)" required="">
                </td>
            </tr>
            <tr>
                <td>Point 2:</td>
                <td>
                    <input type="text" name="lat2" class="lat2" value="58 38 38N" placeholder="Lat 2 (°N/S)" title="Lat 2 (°N/S)" required=""> ,
                    <input type="text" name="lon2" class="lon2" value="003 04 12W" placeholder="Lon 2 (°E/W)" title="Lon 2 (°E/W)" required="">
                </td>
            </tr>
        </tbody></table>
        <table class="outputs">
            <tbody><tr>
                <td>Distance:</td>
                <td>
                    <output class="result-dist" title="Distance (in km)">968.9</output> km
                    <span title="rounding to 4 significant figures reflects the approx. 0.3% accuracy of the spherical model" class="small grey">(to 4 SF<sup>*</sup>)</span>
                </td>
            </tr>
            <tr>
                <td>Initial bearing:</td>
                <td><output class="result-brng1" title="Initial bearing (azimuth) between points">009°07′11″</output></td>
            </tr>
            <tr>
                <td>Final bearing:</td>
                <td><output class="result-brng2" title="Final bearing (azimuth) between points">011°16′31″</output></td>
            </tr>
            <tr>
                <td>Midpoint:</td>
                <td><output class="result-midpt" title="Midpoint between points">54°21′44″N, 004°31′50″W</output></td>
            </tr>
        </tbody></table>
        <p class="toggle-map">And you can <a>see it on a map</a> (aren’t those Google guys wonderful!)</p>
        <p class="toggle-map hide"><a>... hide map</a></p>
        <div id="map-ortho-dist-canvas" class="map" style="position: relative; overflow: hidden; transform: translateZ(0px); background-color: rgb(229, 227, 223);"><div class="gm-style" style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0;"><div style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0; cursor: url(http://maps.gstatic.com/mapfiles/openhand_8_8.cur) 8 8, default;"><div style="position: absolute; left: 0px; top: 0px; z-index: 1; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, 0, 0);"><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 100; width: 100%;"><div style="position: absolute; left: 0px; top: 0px; z-index: 0;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -128px; top: -128px;"></div></div></div></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 101; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 102; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 103; width: 100%;"><div style="position: absolute; left: 0px; top: 0px; z-index: -1;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -128px; top: -128px;"></div></div></div></div><div style="position: absolute; z-index: 0; transform: translateZ(0px); left: 0px; top: 0px;"><div style="overflow: hidden;"></div></div><div style="position: absolute; left: 0px; top: 0px; z-index: 0;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -128px; top: -128px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/kh" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/vt" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;"></div></div></div></div><div style="position: absolute; left: 0px; top: 0px; z-index: 2; width: 100%; height: 100%;"></div><div style="position: absolute; left: 0px; top: 0px; z-index: 3; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, 0, 0);"><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 104; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 105; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 106; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 107; width: 100%;"></div></div></div><div style="margin-left: 5px; margin-right: 5px; z-index: 1000000; position: absolute; left: 0px; bottom: 0px;"><a target="_blank" href="https://maps.google.com/maps?ll=0,0&z=0&t=h&hl=en-US&gl=US&mapclient=apiv3" title="Click to see this area on Google Maps" style="position: static; overflow: visible; float: none; display: inline;"><div style="width: 62px; height: 26px; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/google_white2_hdpi.png" draggable="false" style="position: absolute; left: 0px; top: 0px; width: 62px; height: 26px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></a></div><div class="gmnoprint" style="z-index: 1000001; position: absolute; right: 0px; bottom: 0px; width: 12px;"><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a style="color: rgb(68, 68, 68); text-decoration: none; cursor: pointer; display: none;">Map Data</a><span style="display: none;"></span></div></div></div><div style="padding: 15px 21px; border: 1px solid rgb(171, 171, 171); font-family: Roboto, Arial, sans-serif; color: rgb(34, 34, 34); -webkit-box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; z-index: 10000002; display: none; width: 0px; height: 0px; position: absolute; left: 5px; top: 5px; background-color: white;"><div style="padding: 0px 0px 10px; font-size: 16px;">Map Data</div><div style="font-size: 13px;"></div><div style="width: 13px; height: 13px; overflow: hidden; position: absolute; opacity: 0.7; right: 12px; top: 12px; z-index: 10000; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6.png" draggable="false" style="position: absolute; left: -2px; top: -336px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoscreen" style="position: absolute; right: 0px; bottom: 0px;"><div style="font-family: Roboto, Arial, sans-serif; font-size: 11px; color: rgb(68, 68, 68); direction: ltr; text-align: right; background-color: rgb(245, 245, 245);"></div></div><div class="gmnoprint gm-style-cc" draggable="false" style="z-index: 1000001; position: absolute; -webkit-user-select: none; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a href="https://www.google.com/intl/en-US_US/help/terms_maps.html" target="_blank" style="text-decoration: none; cursor: pointer; color: rgb(68, 68, 68);">Terms of Use</a></div></div><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; display: none; position: absolute; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a target="_new" title="Report errors in the road map or imagery to Google" href="https://www.google.com/maps/@0,0,0z/data=!3m1!1e3!10m1!1e1!12b1?source=apiv3&rapsrc=apiv3" style="font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); text-decoration: none; position: relative;">Report a map error</a></div></div><div class="gmnoprint" draggable="false" controlwidth="32" controlheight="84" style="margin: 5px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"><div controlwidth="32" controlheight="40" style="cursor: url(http://maps.gstatic.com/mapfiles/openhand_8_8.cur) 8 8, default; position: absolute; left: 0px; top: 0px;"><div aria-label="Street View Pegman Control" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -9px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Pegman is disabled" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -107px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Pegman is on top of the Map" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -58px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Street View Pegman Control" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -205px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoprint" controlwidth="0" controlheight="0" style="opacity: 0.6; display: none; position: absolute;"><div title="Rotate map 90 degrees" style="width: 22px; height: 22px; overflow: hidden; position: absolute; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6_hdpi.png" draggable="false" style="position: absolute; left: -38px; top: -360px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoprint" controlwidth="20" controlheight="39" style="position: absolute; left: 6px; top: 45px;"><div style="width: 20px; height: 39px; overflow: hidden; position: absolute;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6_hdpi.png" draggable="false" style="position: absolute; left: -39px; top: -401px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div title="Zoom in" style="position: absolute; left: 0px; top: 2px; width: 20px; height: 17px; cursor: pointer;"></div><div title="Zoom out" style="position: absolute; left: 0px; top: 19px; width: 20px; height: 17px; cursor: pointer;"></div></div></div><div class="gmnoprint gm-style-mtc" style="margin: 5px; z-index: 0; position: absolute; cursor: pointer; text-align: left; width: 85px; right: 0px; top: 0px;"><div draggable="false" title="Change map style" style="direction: ltr; overflow: hidden; text-align: left; position: relative; color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 1px 6px; border-radius: 2px; -webkit-background-clip: padding-box; border: 1px solid rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; font-weight: 500; background-color: rgb(255, 255, 255); background-clip: padding-box;">Satellite<img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/arrow-down.png" draggable="false" style="-webkit-user-select: none; border: 0px; padding: 0px; margin: -2px 0px 0px; position: absolute; right: 6px; top: 50%; width: 7px; height: 4px;"></div><div style="z-index: -1; padding-top: 2px; -webkit-background-clip: padding-box; border-width: 0px 1px 1px; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-right-color: rgba(0, 0, 0, 0.14902); border-bottom-color: rgba(0, 0, 0, 0.14902); border-left-color: rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; position: relative; text-align: left; display: none; background-color: white; background-clip: padding-box;"><div draggable="false" title="Show street map" style="color: black; font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px; background-color: rgb(255, 255, 255);">Map</div><div draggable="false" title="Show satellite imagery" style="color: black; font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px; font-weight: 500; background-color: rgb(255, 255, 255);">Satellite</div><div style="margin: 1px 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(235, 235, 235);"></div><div draggable="false" title="Show street map with terrain" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; display: none; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden; display: none;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">Terrain</label></div><div style="margin: 1px 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(235, 235, 235); display: none;"></div><div draggable="false" title="Show 45 degree view" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden; display: none;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">45°</label></div><div draggable="false" title="Show imagery with street names" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">Labels</label></div></div></div><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; position: absolute; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><span>10000 km&nbsp;</span><div style="position: relative; display: inline-block; height: 8px; bottom: -1px; width: 64px;"><div style="width: 100%; height: 4px; position: absolute; bottom: 0px; left: 0px; background-color: rgb(255, 255, 255);"></div><div style="position: absolute; left: 0px; top: 0px; width: 4px; height: 8px; background-color: rgb(255, 255, 255);"></div><div style="width: 4px; height: 8px; position: absolute; bottom: 0px; right: 0px; background-color: rgb(255, 255, 255);"></div><div style="position: absolute; height: 2px; bottom: 1px; right: 1px; left: 1px; background-color: rgb(102, 102, 102);"></div><div style="position: absolute; left: 1px; top: 1px; width: 2px; height: 6px; background-color: rgb(102, 102, 102);"></div><div style="width: 2px; height: 6px; position: absolute; bottom: 1px; right: 1px; background-color: rgb(102, 102, 102);"></div></div></div></div></div></div>
    </fieldset>
</form>


<h3>Distance</h3>

<p>This uses the ‘<b>haversine</b>’ formula to calculate the great-circle distance between two
    points – that is, the shortest distance over the earth’s surface – giving an ‘as-the-crow-flies’
    distance between the  points (ignoring any hills they fly over, of course!).</p>
<table>
    <tbody><tr id="haversine">
        <td class="label">Haversine<br>formula:</td>
        <td class="formula">
            a = sin²(Δφ/2) + cos φ<sub>1</sub> ⋅ cos φ<sub>2</sub> ⋅ sin²(Δλ/2)<br>
            c = 2 ⋅ atan2( √<span class="radicand">a</span>, √<span class="radicand">(1−a)</span> )<br>
            d = R ⋅ c
        </td>
    </tr>
    <tr>
        <td class="label align-right">where</td>
        <td><i></i>φ<i> is latitude, </i>λ<i> is longitude, </i>R<i> is earth’s radius (mean radius = 6,371km);<br>
            note that angles need to be in radians to pass to trig functions!</i></td>
    </tr>
    <tr>
        <td class="label">JavaScript:</td>
        <td><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">6371000</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// metres</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> lat1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> lat2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat2</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">lat1</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon2</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">lon1</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> a </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">
        </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">
        </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> c </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> c</span></span><span class="pun"><span class="pun">;</span></span></pre>
        </td>
    </tr>
</tbody></table>

<p><i>Note in these scripts, I generally use lat/lon for latitude/longitude in degrees, and φ/λ for
    latitude/longitude in radians – having found that mixing degrees &amp; radians is often the
    easiest route to head-scratching bugs...</i></p>

<aside><p><i>Historical aside</i>:
    The height of tech­nology for navigator’s calculations used to be log tables. As there is no
    (real) log of a negative number, the ‘versine’ enabled them to keep trig func­tions in
    positive numbers. Also, the sin²(θ/2) form of the haversine avoided addition (which en­tailed
    an anti-log lookup, the addi­tion, and a log lookup).
    Printed <a href="http://haversine.files.wordpress.com/2012/08/haversines.jpg" target="_blank">tables</a> for the
    haver­sine/in­verse-haver­sine (and its log­arithm, to aid
    multip­lica­tions) saved navi­gators from squaring sines, com­puting square roots,
    etc – arduous and error-prone activ­ities.</p>
</aside>

<p>The <a href="http://en.wikipedia.org/wiki/Haversine_formula" target="_blank">haversine</a>
    formula<sup><a href="http://mathforum.org/library/drmath/view/51879.html" target="_blank">1</a></sup> ‘remains
    particularly well-conditioned for numerical computa­tion even at small distances’ – unlike
    calculations based on the <span title="cos c = cos a cos b + sin a sin b cos C"><i>spherical law
    of cosines</i></span>. The ‘versed sine’ is <span class="formula">1−cosθ</span>, and the
    ‘half-versed-sine’ is <span class="formula">(1−cosθ)/2 = sin²(θ/2)</span> as used above.
    Once widely used by navigators, it was described by Roger Sinnott in
    <a href="https://www.shopatsky.com/product/sky-and-telescope-august-1984-digital-issue/sky-and-telescope-digital-issues-1980-1989" target="_blank"><i>Sky &amp; Telescope</i></a>
    magazine in 1984 (“Virtues of the Haversine”): Sinnott explained that the angular separation
    between Mizar and Alcor in Ursa Major – 0°11′49.69″ – could be accurately calculated on a
    <a href="http://en.wikipedia.org/wiki/TRS-80#modeliii" target="_blank">TRS-80</a> using the haversine.</p>
<p>For the curious, <i>c</i> is the angular distance in radians, and <i>a</i> is the square of half
    the chord length between the points. A (remarkably marginal) performance improvement can be
    obtained by factoring out the terms which get squared.</p>

<h4 id="cosine-law">Spherical Law of Cosines</h4>

<p>In fact, JavaScript (and most modern computers &amp; languages) use ‘IEEE 754’ 64-bit floating-point
    numbers, which provide 15 significant figures of precision. By my estimate, with this precision,
    the simple <a href="http://mathworld.wolfram.com/SphericalTrigonometry.html" target="_blank">spherical law of
    cosines</a> formula (cos <i>c</i> = cos <i>a</i> cos <i>b</i> + sin <i>a</i> sin <i>b</i> cos <i>C</i>)
    gives well-conditioned results down to distances as small as a few metres on the earth’s surface.
    <span class="note">(<i>Note that the geodetic form of the law of cosines is rearranged from the
    canonical one so that the latitude can be used directly, rather than the
    <a href="http://mathworld.wolfram.com/Colatitude.html" target="_blank">colatitude</a></i>).</span></p>
<p>This makes the simpler law of cosines a reasonable 1-line alternative to the haversine formula for
    many geodesy purposes (if not for astronomy). The choice may be driven by coding context,
    available trig functions (in different languages), etc – and, for very small distances an
    equirectangular approximation may be more suitable.</p>
  
<table>
    <tbody><tr>
        <td class="label">Law of cosines:</td>
        <td class="formula">d = acos( sin φ<sub>1</sub> ⋅ sin φ<sub>2</sub> + cos φ<sub>1</sub> ⋅ cos φ<sub>2</sub> ⋅ cos Δλ ) ⋅ R</td>
    </tr>
    <tr>
        <td class="label">JavaScript:</td>
        <td><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> lat1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> lat2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon2</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">lon1</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">6371000</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// gives d in metres</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span></pre>
        </td>
    </tr>
    <tr>
        <td class="label">Excel:</td>
        <td class="code">=ACOS( SIN(lat1)*SIN(lat2) + COS(lat1)*COS(lat2)*COS(lon2-lon1) ) * 6371000</td>
    </tr>
    <tr>
        <td class="label">(or with lat/lon in degrees):</td>
        <td class="code">=ACOS( SIN(lat1*PI()/180)*SIN(lat2*PI()/180) + COS(lat1*PI()/180)*COS(lat2*PI()/180)*COS(lon2*PI()/180-lon1*PI()/180) ) * 6371000</td>
    </tr>
</tbody></table>

<h4 id="equirectangular">Equirectangular approximation</h4>

<p>If performance is an issue and accuracy less important, for small distances 
    <a href="http://en.wikipedia.org/wiki/Pythagorean_theorem" target="_blank">Pythagoras’
    theorem</a> can be used on an <a href="http://en.wikipedia.org/wiki/Equirectangular_projection" target="_blank">equirectangular
    projection</a>:<sup title="merci à Laurent Grégoire">*</sup></p>
<table>
    <tbody><tr>
        <td class="label">Formula</td>
        <td class="formula">
            x = Δλ ⋅ cos φ<sub>m</sub><br>
            y = Δφ<br>
            d = R ⋅ √<span class="radicand">x² + y²</span>
        </td>
    </tr>
        <tr>
        <td class="label">JavaScript:</td>
        <td><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">((φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> y </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">x</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">x </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> y</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span></pre></td>
    </tr>
</tbody></table>

<p>This uses just one trig and one sqrt function – as against half-a-dozen trig functions for cos
    law, and 7 trigs + 2 sqrts for haversine. Accuracy is somewhat complex: along meridians there
    are no errors, otherwise they depend on distance, bearing,  and latitude, but are small enough
    for many purposes<sup title="anyone care to quantify them?">*</sup> (and often trivial compared
    with the spherical approximation itself).</p>

<p>Alternatively, the <i>polar coordinate flat-earth formula</i> can be used:
    using the co-latitudes θ<sub>1</sub> = π/2−φ<sub>1</sub> and θ<sub>2</sub> = π/2−φ<sub>2</sub>,
    then <span class="formula nowrap">d = R ⋅ √<span class="radicand">θ<sub>1</sub>² + θ<sub>2</sub>² − 2 ⋅ θ<sub>1</sub> ⋅ θ<sub>2</sub> ⋅ cos Δλ</span></span>.
    I’ve not compared accuracy.</p>

<figure class="float-right"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/baghdad-to-osaka.jpg" alt="Baghdad to Osaka">
    <figcaption>Baghdad to Osaka – <br>
    not a constant bearing!</figcaption>
</figure>

<h3 id="bearing">Bearing</h3>

<p>In general, your current heading will vary as you  follow a great circle path (orthodrome); the
    final heading will differ from the initial heading by varying degrees according to distance and
    latitude (if you were to go from say 35°N,45°E (≈&nbsp;Baghdad) to 35°N,135°E (≈&nbsp;Osaka), you
    would start on a heading of 60° and end up on a heading of 120°!).</p>
<p>This formula is for the initial bearing (sometimes referred to as forward azimuth) which if
    followed in a straight line along a great-circle arc will take you from the start point to the
    end point:<sup><a href="http://mathforum.org/library/drmath/view/55417.html" target="_blank">1</a></sup></p>
<table>
    <tbody><tr>
        <td class="label">Formula:</td>
        <td class="formula">θ = atan2( sin Δλ ⋅ cos φ<sub>2</sub> , cos φ<sub>1</sub> ⋅ sin φ<sub>2</sub>  − sin φ<sub>1</sub> ⋅ cos φ<sub>2</sub> ⋅ cos Δλ )</td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> y </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">
        </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> brng </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> x</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span></pre></td>
    </tr>
    <tr>
        <td class="label">Excel:<div class="small grey">(all angles <br>in radians)</div></td>
        <td class="code nowrap">=ATAN2(COS(lat1)*SIN(lat2)-SIN(lat1)*COS(lat2)*COS(lon2-lon1), <br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SIN(lon2-lon1)*COS(lat2))
            <br><span class="note">*note that Excel reverses the arguments to ATAN2 – see notes below</span>
        </td>
    </tr>
</tbody></table>
<p class="note">Since atan2 returns values in the range -π ... +π (that is, -180° ... +180°), to
    normalise the result to a compass bearing (in the range 0° ... 360°, with −ve values transformed
    into the range 180° ... 360°), convert to degrees and then use (θ+360)&nbsp;%&nbsp;360, where %
    is (floating point) modulo.</p>
<p class="note">For final bearing, simply take the <i>initial</i> bearing from the <i>end</i> point
    to the <i>start</i> point and reverse it (using θ = (θ+180) % 360).</p>

<h3 id="midpoint">Midpoint</h3>

<p>This is the half-way point along a great circle path between the two
    points.<sup><a href="http://mathforum.org/library/drmath/view/51822.html" title="Mathforum derivation" target="_blank">1</a></sup></p>
<table>
    <tbody><tr>
        <td class="label">Formula:</td>
        <td class="formula">
            B<sub>x</sub> = cos φ<sub>2</sub> ⋅ cos Δλ<br>
            B<sub>y</sub> = cos φ<sub>2</sub> ⋅ sin Δλ<br>
            φ<sub>m</sub> = atan2( sin φ<sub>1</sub> + sin φ<sub>2</sub>, √<span class="radicand">(cos φ<sub>1</sub> + B<sub>x</sub>)²
            + B<sub>y</sub>²</span> )<br>
            λ<sub>m</sub> = λ<sub>1</sub> + atan2(B<sub>y</sub>, cos(φ<sub>1</sub>)+B<sub>x</sub>)
        </td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Bx</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">By</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln">
                    </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)+</span></span><span class="typ"><span class="typ">Bx</span></span><span class="pun"><span class="pun">)*(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)+</span></span><span class="typ"><span class="typ">Bx</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">By</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">By</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">By</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Bx</span></span><span class="pun"><span class="pun">);</span></span></pre></td>
    </tr>
</tbody></table>

<p class="note">Just as the initial bearing may vary from the final bearing, the midpoint may 
    not be located half-way between latitudes/longitudes; the midpoint between 35°N,45°E
    and 35°N,135°E is around 45°N,90°E.</p>
<p>&nbsp;</p>

<hr>

<h3 id="destPoint"><b>Destination point given distance and bearing from start point</b></h3>

<p>Given a start point, initial bearing, and distance, this will calculate the destination point and
    final bearing travelling along a (shortest distance) great circle arc.</p>

<form name="ortho-dest" id="ortho-dest">
    <fieldset><legend>Destination point along great-circle given distance and bearing from start point</legend>
        <table class="inputs">
            <tbody><tr>
                <td>Start point:</td>
                <td>
                <input name="lat1" class="lat1" type="text" value="53°19′14″N">,
                <input name="lon1" class="lon1" type="text" value="001°43′47″W"></td>
            </tr>
            <tr>
                <td>Bearing:</td>
                <td><input type="text" name="brng" class="brng" value="096°01′18″"></td>
            </tr>
            <tr>
                <td>Distance:</td>
                <td><input name="dist" class="dist" type="number" step="any" value="124.8"> km</td>
            </tr>
        </tbody></table>
        <table class="outputs">
            <tbody><tr>
                <td>Destination point:</td>
                <td><output class="result-point" title="Destination point">53°11′18″N, 000°08′00″E</output></td>
            </tr>
            <tr>
                <td>Final bearing:</td>
                <td><output class="result-brng" title="Final bearing (azimuth) arriving at point 2">097°30′52″</output></td>
            </tr>
            <tr>
                <td>
                    <p class="toggle-map"><a>view map</a></p>
                    <p class="toggle-map hide"><a>hide map</a></p>
                </td>
                <td></td>
            </tr>
        </tbody></table>
        <div id="map-ortho-dest-canvas" class="map" style="position: relative; overflow: hidden; transform: translateZ(0px); background-color: rgb(229, 227, 223);"><div class="gm-style" style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0;"><div style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0; cursor: url(http://maps.gstatic.com/mapfiles/openhand_8_8.cur) 8 8, default;"><div style="position: absolute; left: 0px; top: 0px; z-index: 1; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, 0, 0);"><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 100; width: 100%;"><div style="position: absolute; left: 0px; top: 0px; z-index: 0;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -128px; top: -128px;"></div></div></div></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 101; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 102; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 103; width: 100%;"><div style="position: absolute; left: 0px; top: 0px; z-index: -1;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -128px; top: -128px;"></div></div></div></div><div style="position: absolute; z-index: 0; transform: translateZ(0px); left: 0px; top: 0px;"><div style="overflow: hidden;"></div></div><div style="position: absolute; left: 0px; top: 0px; z-index: 0;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -128px; top: -128px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/kh" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/vt" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;"></div></div></div></div><div style="position: absolute; left: 0px; top: 0px; z-index: 2; width: 100%; height: 100%;"></div><div style="position: absolute; left: 0px; top: 0px; z-index: 3; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, 0, 0);"><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 104; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 105; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 106; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 107; width: 100%;"></div></div></div><div style="margin-left: 5px; margin-right: 5px; z-index: 1000000; position: absolute; left: 0px; bottom: 0px;"><a target="_blank" href="https://maps.google.com/maps?ll=0,0&z=0&t=h&hl=en-US&gl=US&mapclient=apiv3" title="Click to see this area on Google Maps" style="position: static; overflow: visible; float: none; display: inline;"><div style="width: 62px; height: 26px; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/google_white2_hdpi.png" draggable="false" style="position: absolute; left: 0px; top: 0px; width: 62px; height: 26px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></a></div><div class="gmnoprint" style="z-index: 1000001; position: absolute; right: 0px; bottom: 0px; width: 12px;"><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a style="color: rgb(68, 68, 68); text-decoration: none; cursor: pointer; display: none;">Map Data</a><span style="display: none;"></span></div></div></div><div style="padding: 15px 21px; border: 1px solid rgb(171, 171, 171); font-family: Roboto, Arial, sans-serif; color: rgb(34, 34, 34); -webkit-box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; z-index: 10000002; display: none; width: 0px; height: 0px; position: absolute; left: 5px; top: 5px; background-color: white;"><div style="padding: 0px 0px 10px; font-size: 16px;">Map Data</div><div style="font-size: 13px;"></div><div style="width: 13px; height: 13px; overflow: hidden; position: absolute; opacity: 0.7; right: 12px; top: 12px; z-index: 10000; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6.png" draggable="false" style="position: absolute; left: -2px; top: -336px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoscreen" style="position: absolute; right: 0px; bottom: 0px;"><div style="font-family: Roboto, Arial, sans-serif; font-size: 11px; color: rgb(68, 68, 68); direction: ltr; text-align: right; background-color: rgb(245, 245, 245);"></div></div><div class="gmnoprint gm-style-cc" draggable="false" style="z-index: 1000001; position: absolute; -webkit-user-select: none; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a href="https://www.google.com/intl/en-US_US/help/terms_maps.html" target="_blank" style="text-decoration: none; cursor: pointer; color: rgb(68, 68, 68);">Terms of Use</a></div></div><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; display: none; position: absolute; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a target="_new" title="Report errors in the road map or imagery to Google" href="https://www.google.com/maps/@0,0,0z/data=!3m1!1e3!10m1!1e1!12b1?source=apiv3&rapsrc=apiv3" style="font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); text-decoration: none; position: relative;">Report a map error</a></div></div><div class="gmnoprint" draggable="false" controlwidth="32" controlheight="84" style="margin: 5px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"><div controlwidth="32" controlheight="40" style="cursor: url(http://maps.gstatic.com/mapfiles/openhand_8_8.cur) 8 8, default; position: absolute; left: 0px; top: 0px;"><div aria-label="Street View Pegman Control" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -9px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Pegman is disabled" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -107px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Pegman is on top of the Map" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -58px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Street View Pegman Control" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -205px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoprint" controlwidth="0" controlheight="0" style="opacity: 0.6; display: none; position: absolute;"><div title="Rotate map 90 degrees" style="width: 22px; height: 22px; overflow: hidden; position: absolute; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6_hdpi.png" draggable="false" style="position: absolute; left: -38px; top: -360px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoprint" controlwidth="20" controlheight="39" style="position: absolute; left: 6px; top: 45px;"><div style="width: 20px; height: 39px; overflow: hidden; position: absolute;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6_hdpi.png" draggable="false" style="position: absolute; left: -39px; top: -401px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div title="Zoom in" style="position: absolute; left: 0px; top: 2px; width: 20px; height: 17px; cursor: pointer;"></div><div title="Zoom out" style="position: absolute; left: 0px; top: 19px; width: 20px; height: 17px; cursor: pointer;"></div></div></div><div class="gmnoprint gm-style-mtc" style="margin: 5px; z-index: 0; position: absolute; cursor: pointer; text-align: left; width: 85px; right: 0px; top: 0px;"><div draggable="false" title="Change map style" style="direction: ltr; overflow: hidden; text-align: left; position: relative; color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 1px 6px; border-radius: 2px; -webkit-background-clip: padding-box; border: 1px solid rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; font-weight: 500; background-color: rgb(255, 255, 255); background-clip: padding-box;">Satellite<img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/arrow-down.png" draggable="false" style="-webkit-user-select: none; border: 0px; padding: 0px; margin: -2px 0px 0px; position: absolute; right: 6px; top: 50%; width: 7px; height: 4px;"></div><div style="z-index: -1; padding-top: 2px; -webkit-background-clip: padding-box; border-width: 0px 1px 1px; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-right-color: rgba(0, 0, 0, 0.14902); border-bottom-color: rgba(0, 0, 0, 0.14902); border-left-color: rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; position: relative; text-align: left; display: none; background-color: white; background-clip: padding-box;"><div draggable="false" title="Show street map" style="color: black; font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px; background-color: rgb(255, 255, 255);">Map</div><div draggable="false" title="Show satellite imagery" style="color: black; font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px; font-weight: 500; background-color: rgb(255, 255, 255);">Satellite</div><div style="margin: 1px 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(235, 235, 235);"></div><div draggable="false" title="Show street map with terrain" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; display: none; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden; display: none;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">Terrain</label></div><div style="margin: 1px 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(235, 235, 235); display: none;"></div><div draggable="false" title="Show 45 degree view" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden; display: none;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">45°</label></div><div draggable="false" title="Show imagery with street names" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">Labels</label></div></div></div><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; position: absolute; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><span>10000 km&nbsp;</span><div style="position: relative; display: inline-block; height: 8px; bottom: -1px; width: 64px;"><div style="width: 100%; height: 4px; position: absolute; bottom: 0px; left: 0px; background-color: rgb(255, 255, 255);"></div><div style="position: absolute; left: 0px; top: 0px; width: 4px; height: 8px; background-color: rgb(255, 255, 255);"></div><div style="width: 4px; height: 8px; position: absolute; bottom: 0px; right: 0px; background-color: rgb(255, 255, 255);"></div><div style="position: absolute; height: 2px; bottom: 1px; right: 1px; left: 1px; background-color: rgb(102, 102, 102);"></div><div style="position: absolute; left: 1px; top: 1px; width: 2px; height: 6px; background-color: rgb(102, 102, 102);"></div><div style="width: 2px; height: 6px; position: absolute; bottom: 1px; right: 1px; background-color: rgb(102, 102, 102);"></div></div></div></div></div></div>
    </fieldset>
</form>

<table>
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">φ<sub>2</sub> = asin( sin φ<sub>1</sub> ⋅ cos δ + cos φ<sub>1</sub> ⋅ sin δ ⋅ cos θ )</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">λ<sub>2</sub> = λ<sub>1</sub> + atan2( sin θ ⋅ sin δ ⋅ cos φ<sub>1</sub>, cos δ − sin φ<sub>1</sub> ⋅ sin φ<sub>2</sub> )</td>
    </tr>
    <tr>
        <td class="label align-right">where</td>
        <td><i></i>φ<i> is latitude, </i>λ<i> is longitude, </i>θ<i> is the bearing (clockwise from north),
            δ is the angular distance </i>d/R<i>; </i>d<i> being the distance travelled, </i>R<i> the earth’s radius</i></td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">
                    </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">brng</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">brng</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln">
                         </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">)-</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">));</span></span></pre></td>
    </tr>
    <tr>
        <td class="label">Excel:<div class="small grey">(all angles <br>in radians)</div></td>
        <td class="code">lat2: =ASIN(SIN(lat1)*COS(d/R) + COS(lat1)*SIN(d/R)*COS(brng))<br>
            lon2: =lon1 + ATAN2(COS(d/R)-SIN(lat1)*SIN(lat2), SIN(brng)*SIN(d/R)*COS(lat1))
            <br><span class="note">* Remember that Excel reverses the arguments to ATAN2 – see notes below</span></td>
    </tr>
</tbody></table>

<p class="note">For final bearing, simply take the <i>initial</i> bearing from the <i>end</i> point to the <i>start</i>
    point and reverse it (using θ = (θ+180) % 360).</p>
<p>&nbsp;</p>

<hr>

<h3 id="intersection">Intersection of two paths given start points and bearings</h3>

<p>This is a rather more complex calculation than most others on this page, but I've been asked for it a number of times.
    This comes from Ed William’s <a href="http://williams.best.vwh.net/avform.htm#Intersection" target="_blank">aviation formulary</a>.
    See below for the JavaScript.</p>

<form name="intersect" id="intersect">
    <fieldset><legend>Intersection of two great-circle paths</legend>
        <table class="inputs">
            <tbody><tr>
                <td>Point 1:</td>
                <td>
                <input name="lat1" class="lat1" type="text" value="51.8853 N" title="Latitude 1">,
                <input name="lon1" class="lon1" type="text" value="0.2545 E" title="Longitude 1">
                Brng 1:
                <input name="brng1" class="brng1" type="text" value="108.55°" title="Bearing 1">
                </td>
            </tr>
            <tr>
                <td>Point 2:</td>
                <td>
                <input name="lat2" class="lat2" type="text" value="49.0034 N" title="Latitude 2">,
                <input name="lon2" class="lon2" type="text" value="2.5735 E" title="Longitude 2">
                Brng 2:
                <input name="brng1" class="brng2" type="text" value="32.44°" title="Bearing 2">
                </td>
            </tr>
        </tbody></table>
        <table class="outputs">
            <tbody><tr>
                <td>Intersection point:</td>
                <td><output class="result-point" title="Intersection point">50°54′27″N, 004°30′31″E</output></td>
            </tr>
            <tr>
                <td colspan="2"><p>&nbsp;</p></td>
            </tr>
        </tbody></table>
    </fieldset>
</form>

<table class="clear-floats">
  <tbody><tr>
    <td class="label">Formula: </td>
    <td class="formula">
      <p>δ<sub>12</sub> = 2⋅asin( √<span class="radicand">(sin²(Δφ/2) + cos φ<sub>1</sub> ⋅ cos φ<sub>2</sub> ⋅ sin²(Δλ/2))</span> )<br>
          θ<sub>a</sub> = acos( sin φ<sub>2</sub>  − sin φ<sub>1</sub> ⋅ cos δ<sub>12</sub> / sin δ<sub>12</sub> ⋅ cos φ<sub>1</sub> )<br>
          θ<sub>b</sub> = acos( sin φ<sub>1</sub>  − sin φ<sub>2</sub> ⋅ cos δ<sub>12</sub> / sin δ<sub>12</sub> ⋅ cos φ<sub>2</sub> )</p>
      <p>if sin(λ<sub>2</sub>−λ<sub>1</sub>) &gt; 0<br>
          &nbsp;&nbsp;&nbsp;&nbsp;θ<sub>12</sub> = θ<sub>a</sub><br>
          &nbsp;&nbsp;&nbsp;&nbsp;θ<sub>21</sub> = 2π − θ<sub>b</sub><br>
      else<br>
          &nbsp;&nbsp;&nbsp;&nbsp;θ<sub>12</sub> = 2π − θ<sub>a</sub><br>
          &nbsp;&nbsp;&nbsp;&nbsp;θ<sub>21</sub> = θ<sub>b</sub></p>
      <p> α<sub>1</sub> = (θ<sub>13</sub> − θ<sub>12</sub> + π) % 2π − π<br>
        α<sub>2</sub> = (θ<sub>21</sub> − θ<sub>23</sub> + π) % 2π − π</p>
      <!-- <p>α<sub>1</sub> = |α<sub>1</sub>|<br> α<sub>2</sub> = |α<sub>2</sub>|</p> -->
      <p>α<sub>3</sub> = acos( −cos α<sub>1</sub> ⋅ cos α<sub>2</sub> + sin α<sub>1</sub> ⋅ sin α<sub>2</sub> ⋅ cos δ<sub>12</sub> )<br>
         δ<sub>13</sub> = atan2( sin δ<sub>12</sub> ⋅ sin α<sub>1</sub> ⋅ sin α<sub>2</sub> , cos α<sub>2</sub> + cos α<sub>1</sub> ⋅ cos α<sub>3</sub> )<br>
         φ<sub>3</sub> = asin( sin φ<sub>1</sub> ⋅ cos δ<sub>13</sub> + cos φ<sub>1</sub> ⋅ sin δ<sub>13</sub> ⋅ cos θ<sub>13</sub> )<br>
         Δλ<sub>13</sub> = atan2( sin θ<sub>13</sub> ⋅ sin δ<sub>13</sub> ⋅ cos φ<sub>1</sub> , cos δ<sub>13</sub> − sin φ<sub>1</sub> ⋅ sin φ<sub>3</sub> ) <br>
         λ<sub>3</sub> = (λ<sub>1</sub>+Δλ<sub>13</sub>+π) % 2π − π</p>
    </td>
  </tr>
  <tr>
    <td class="label align-right"><i>where</i></td>
    <td><p><i>φ<sub>1</sub>, λ<sub>1</sub>, θ<sub>1</sub> : 1st point &amp; bearing<br>
      φ<sub>2</sub>, λ<sub>2</sub>, θ<sub>2</sub> : 2nd point &amp; bearing<br>
      φ<sub>3</sub>, λ<sub>3</sub> : intersection point</i></p>
        <p><i>% = (floating point) modulo<!--, | | = abs--></i></p></td>
  </tr>
  <tr>
    <td class="label align-right">note –</td>
    <td>if sin α<sub>1</sub> = 0 and sin α<sub>2</sub> = 0: infinite solutions<br>
      if sin α<sub>1</sub> ⋅ sin α<sub>2</sub>  &lt; 0: ambiguous solution<br>
      this formulation is not always well-conditioned for meridional or equatorial lines</td>
  </tr>
</tbody></table>
<p>This is a lot simpler using vectors rather than spherical trigonometry:
    see <a href="http://www.movable-type.co.uk/scripts/latlong-vectors.html#intersection">latlong-vectors.html</a>.</p>
<hr>

<h3 id="cross-track">Cross-track distance</h3>

<p>Here’s a new one:  I’ve sometimes been asked about distance of a point from a great-circle path 
    (sometimes called cross track error).</p>

<table>
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">d<sub>xt</sub> = asin( sin(δ<sub>13</sub>) ⋅ sin(θ<sub>13</sub>−θ<sub>12</sub>) ) ⋅ R</td>
    </tr>
    <tr>
        <td class="label align-right"><i>where</i></td>
        <td><i>
            δ<sub>13</sub> is (angular) distance from start point to third point<br>
            θ<sub>13</sub> is (initial) bearing from start point to third point<br>
            θ<sub>12</sub> is (initial) bearing from start point to end point<br>
            R is the earth’s radius<br>
            </i>
        </td>
    </tr>
    <tr>
        <td class="label">JavaScript:</td>
        <td><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> dXt </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d13</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">-θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span></pre></td>
    </tr>
</tbody></table>

<p>Here, the great-circle path is identified by a start point and an end point – depending on what initial data you’re working from,
    you can use the formulæ above to obtain the relevant distance and bearings.
    The sign of d<sub>xt</sub> tells you which side of the path the third point is on.</p>
<p>The along-track distance, from the start point to the closest point on the path to the third point, is</p>
<table>
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">d<sub>at</sub> = acos( cos(δ<sub>13</sub>) / cos(δ<sub>xt</sub>) ) ⋅ R</td>
    </tr>
    <tr>
        <td class="label align-right"><i>where</i></td>
        <td><i>
            δ<sub>13</sub> is (angular) distance from start point to third point<br>
            δ<sub>xt</sub> is (angular) cross-track distance<br>
            R is the earth’s radius<br>
            </i>
        </td>
    </tr>
    <tr>
        <td class="label">JavaScript:</td>
        <td><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> dAt </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">d13</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">dXt</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">R</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span></pre></td>
    </tr>
</tbody></table>

<h3 id="clairaut">Closest point to the poles</h3>

<p>And: ‘Clairaut’s formula’ will give you the maximum latitude of a great circle path,
  given a bearing θ and latitude φ on the great circle:
</p><table>
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">φ<sub>max</sub> = acos( | sin θ ⋅ cos φ | )</td>
    </tr>
    <tr>
        <td class="label">JavaScript:</td>
        <td><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="typ"><span class="typ">Max</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ)));</span></span></pre></td>
    </tr>
</tbody></table>
<p>&nbsp;</p>

<hr>

<h3 id="rhumblines">Rhumb lines</h3>

<p>A ‘rhumb line’ (or loxodrome) is a path of constant bearing, which crosses all meridians at the
    same angle.</p>
<p>Sailors used to (and sometimes still) navigate along rhumb lines since it is easier to follow
    a constant compass  bearing than to be continually adjusting the bearing, as is needed to follow
    a great circle. Rhumb lines are straight lines on a Mercator Projection map (also helpful for
    navigation).</p>
<p>Rhumb lines are generally longer than great-circle (orthodrome) routes. For instance, London to New
    York is  4% longer along a rhumb line than along a great circle – important for aviation fuel,
    but not particularly to sailing vessels. New York to Beijing – close to the most extreme example
    possible (though not sailable!) – is 30% longer along a rhumb line.</p>

<form name="rhumb-dist" id="rhumb-dist">
    <fieldset><legend>Rhumb-line distance between two points</legend>
        <table class="inputs">
            <tbody><tr>
                <td>Point 1:</td>
                <td>
                <input name="lat1" class="lat1" type="text" value="50 21 59N" title="Latitude 1">,
                <input name="lon1" class="lon1" type="text" value="004 08 02W" title="Longitude 1">
                </td>
            </tr>
            <tr>
                <td>Point 2:</td>
                <td>
                <input name="lat2" class="lat2" type="text" value="42 21 04N" title="Latitude 2">,
                <input name="lon2" class="lon2" type="text" value="071 02 27W" title="Longitude 2">
                </td>
            </tr>
        </tbody></table>
        <table class="outputs">
            <tbody><tr>
                <td>Distance:</td>
                <td><output class="result-dist" title="Distance (in km)">5198</output> km</td>
            </tr>
            <tr>
                <td>Bearing:</td>
                <td><output class="result-brng" title="Bearing (azimuth) between points">260°07′38″</output></td>
            </tr>
            <tr>
                <td>Midpoint:</td>
                <td><output class="result-midpt" title="Midpoint between points">46°21′32″N, 038°49′00″W</output></td>
            </tr>
            <tr>
                <td>
                    <p class="toggle-map"><a>view map</a></p>
                    <p class="toggle-map hide"><a>hide map</a></p>
                </td>
                <td></td>
            </tr>
        </tbody></table>
        <div id="map-rhumb-dist-canvas" class="map" style="position: relative; overflow: hidden; transform: translateZ(0px); background-color: rgb(229, 227, 223);"><div class="gm-style" style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0;"><div style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0; cursor: url(http://maps.gstatic.com/mapfiles/openhand_8_8.cur) 8 8, default;"><div style="position: absolute; left: 0px; top: 0px; z-index: 1; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, 0, 0);"><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 100; width: 100%;"><div style="position: absolute; left: 0px; top: 0px; z-index: 0;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -128px; top: -128px;"></div></div></div></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 101; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 102; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 103; width: 100%;"><div style="position: absolute; left: 0px; top: 0px; z-index: -1;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -128px; top: -128px;"></div></div></div></div><div style="position: absolute; z-index: 0; transform: translateZ(0px); left: 0px; top: 0px;"><div style="overflow: hidden;"></div></div><div style="position: absolute; left: 0px; top: 0px; z-index: 0;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -128px; top: -128px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/kh" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/vt" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;"></div></div></div></div><div style="position: absolute; left: 0px; top: 0px; z-index: 2; width: 100%; height: 100%;"></div><div style="position: absolute; left: 0px; top: 0px; z-index: 3; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, 0, 0);"><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 104; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 105; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 106; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 107; width: 100%;"></div></div></div><div style="margin-left: 5px; margin-right: 5px; z-index: 1000000; position: absolute; left: 0px; bottom: 0px;"><a target="_blank" href="https://maps.google.com/maps?ll=0,0&z=0&t=h&hl=en-US&gl=US&mapclient=apiv3" title="Click to see this area on Google Maps" style="position: static; overflow: visible; float: none; display: inline;"><div style="width: 62px; height: 26px; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/google_white2_hdpi.png" draggable="false" style="position: absolute; left: 0px; top: 0px; width: 62px; height: 26px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></a></div><div class="gmnoprint" style="z-index: 1000001; position: absolute; right: 0px; bottom: 0px; width: 12px;"><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a style="color: rgb(68, 68, 68); text-decoration: none; cursor: pointer; display: none;">Map Data</a><span style="display: none;"></span></div></div></div><div style="padding: 15px 21px; border: 1px solid rgb(171, 171, 171); font-family: Roboto, Arial, sans-serif; color: rgb(34, 34, 34); -webkit-box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; z-index: 10000002; display: none; width: 0px; height: 0px; position: absolute; left: 5px; top: 5px; background-color: white;"><div style="padding: 0px 0px 10px; font-size: 16px;">Map Data</div><div style="font-size: 13px;"></div><div style="width: 13px; height: 13px; overflow: hidden; position: absolute; opacity: 0.7; right: 12px; top: 12px; z-index: 10000; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6.png" draggable="false" style="position: absolute; left: -2px; top: -336px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoscreen" style="position: absolute; right: 0px; bottom: 0px;"><div style="font-family: Roboto, Arial, sans-serif; font-size: 11px; color: rgb(68, 68, 68); direction: ltr; text-align: right; background-color: rgb(245, 245, 245);"></div></div><div class="gmnoprint gm-style-cc" draggable="false" style="z-index: 1000001; position: absolute; -webkit-user-select: none; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a href="https://www.google.com/intl/en-US_US/help/terms_maps.html" target="_blank" style="text-decoration: none; cursor: pointer; color: rgb(68, 68, 68);">Terms of Use</a></div></div><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; display: none; position: absolute; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a target="_new" title="Report errors in the road map or imagery to Google" href="https://www.google.com/maps/@0,0,0z/data=!3m1!1e3!10m1!1e1!12b1?source=apiv3&rapsrc=apiv3" style="font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); text-decoration: none; position: relative;">Report a map error</a></div></div><div class="gmnoprint" draggable="false" controlwidth="32" controlheight="84" style="margin: 5px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"><div controlwidth="32" controlheight="40" style="cursor: url(http://maps.gstatic.com/mapfiles/openhand_8_8.cur) 8 8, default; position: absolute; left: 0px; top: 0px;"><div aria-label="Street View Pegman Control" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -9px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Pegman is disabled" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -107px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Pegman is on top of the Map" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -58px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Street View Pegman Control" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -205px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoprint" controlwidth="0" controlheight="0" style="opacity: 0.6; display: none; position: absolute;"><div title="Rotate map 90 degrees" style="width: 22px; height: 22px; overflow: hidden; position: absolute; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6_hdpi.png" draggable="false" style="position: absolute; left: -38px; top: -360px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoprint" controlwidth="20" controlheight="39" style="position: absolute; left: 6px; top: 45px;"><div style="width: 20px; height: 39px; overflow: hidden; position: absolute;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6_hdpi.png" draggable="false" style="position: absolute; left: -39px; top: -401px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div title="Zoom in" style="position: absolute; left: 0px; top: 2px; width: 20px; height: 17px; cursor: pointer;"></div><div title="Zoom out" style="position: absolute; left: 0px; top: 19px; width: 20px; height: 17px; cursor: pointer;"></div></div></div><div class="gmnoprint gm-style-mtc" style="margin: 5px; z-index: 0; position: absolute; cursor: pointer; text-align: left; width: 85px; right: 0px; top: 0px;"><div draggable="false" title="Change map style" style="direction: ltr; overflow: hidden; text-align: left; position: relative; color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 1px 6px; border-radius: 2px; -webkit-background-clip: padding-box; border: 1px solid rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; font-weight: 500; background-color: rgb(255, 255, 255); background-clip: padding-box;">Satellite<img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/arrow-down.png" draggable="false" style="-webkit-user-select: none; border: 0px; padding: 0px; margin: -2px 0px 0px; position: absolute; right: 6px; top: 50%; width: 7px; height: 4px;"></div><div style="z-index: -1; padding-top: 2px; -webkit-background-clip: padding-box; border-width: 0px 1px 1px; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-right-color: rgba(0, 0, 0, 0.14902); border-bottom-color: rgba(0, 0, 0, 0.14902); border-left-color: rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; position: relative; text-align: left; display: none; background-color: white; background-clip: padding-box;"><div draggable="false" title="Show street map" style="color: black; font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px; background-color: rgb(255, 255, 255);">Map</div><div draggable="false" title="Show satellite imagery" style="color: black; font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px; font-weight: 500; background-color: rgb(255, 255, 255);">Satellite</div><div style="margin: 1px 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(235, 235, 235);"></div><div draggable="false" title="Show street map with terrain" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; display: none; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden; display: none;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">Terrain</label></div><div style="margin: 1px 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(235, 235, 235); display: none;"></div><div draggable="false" title="Show 45 degree view" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden; display: none;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">45°</label></div><div draggable="false" title="Show imagery with street names" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">Labels</label></div></div></div><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; position: absolute; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><span>10000 km&nbsp;</span><div style="position: relative; display: inline-block; height: 8px; bottom: -1px; width: 64px;"><div style="width: 100%; height: 4px; position: absolute; bottom: 0px; left: 0px; background-color: rgb(255, 255, 255);"></div><div style="position: absolute; left: 0px; top: 0px; width: 4px; height: 8px; background-color: rgb(255, 255, 255);"></div><div style="width: 4px; height: 8px; position: absolute; bottom: 0px; right: 0px; background-color: rgb(255, 255, 255);"></div><div style="position: absolute; height: 2px; bottom: 1px; right: 1px; left: 1px; background-color: rgb(102, 102, 102);"></div><div style="position: absolute; left: 1px; top: 1px; width: 2px; height: 6px; background-color: rgb(102, 102, 102);"></div><div style="width: 2px; height: 6px; position: absolute; bottom: 1px; right: 1px; background-color: rgb(102, 102, 102);"></div></div></div></div></div></div>
    </fieldset>
</form>

<form name="rhumb-dest" id="rhumb-dest" class="demo">
    <fieldset><legend>Destination point along rhumb line given distance and bearing from start point</legend>
        <table class="inputs">
            <tbody><tr>
                <td>Start point:</td>
                <td>
                    <input name="lat1" class="lat1" type="text" value="51 07 32N">,
                    <input name="lon1" class="lon1" type="text" value="001 20 17E">
                </td>
            </tr>
            <tr>
                <td>Bearing:</td>
                <td><input name="brng" class="brng" type="text" value="116°38′10"></td>
            </tr>
            <tr>
                <td>Distance:</td>
                <td><input name="dist" class="dist" type="number" step="any" value="40.23">
                km</td>
            </tr>
        </tbody></table>
        <table class="outputs">
            <tbody><tr>
                <td>Destination point:</td>
                <td><output class="result-point" title="Destination points">50°57′48″N, 001°51′09″E</output></td>
            </tr>
            <tr>
                <td>
                    <p class="toggle-map"><a>view map</a></p>
                    <p class="toggle-map hide"><a>hide map</a></p>
                </td>
                <td></td>
            </tr>
        </tbody></table>
        <div id="map-rhumb-dest-canvas" class="map" style="position: relative; overflow: hidden; transform: translateZ(0px); background-color: rgb(229, 227, 223);"><div class="gm-style" style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0;"><div style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0; cursor: url(http://maps.gstatic.com/mapfiles/openhand_8_8.cur) 8 8, default;"><div style="position: absolute; left: 0px; top: 0px; z-index: 1; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, 0, 0);"><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 100; width: 100%;"><div style="position: absolute; left: 0px; top: 0px; z-index: 0;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -128px; top: -128px;"></div></div></div></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 101; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 102; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 103; width: 100%;"><div style="position: absolute; left: 0px; top: 0px; z-index: -1;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; overflow: hidden; transform: translateZ(0px); position: absolute; left: -128px; top: -128px;"></div></div></div></div><div style="position: absolute; z-index: 0; transform: translateZ(0px); left: 0px; top: 0px;"><div style="overflow: hidden;"></div></div><div style="position: absolute; left: 0px; top: 0px; z-index: 0;"><div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;"><div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: -128px; top: -128px; opacity: 1; transition: opacity 200ms ease-out; -webkit-transition: opacity 200ms ease-out;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/kh" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/vt" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;"></div></div></div></div><div style="position: absolute; left: 0px; top: 0px; z-index: 2; width: 100%; height: 100%;"></div><div style="position: absolute; left: 0px; top: 0px; z-index: 3; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, 0, 0);"><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 104; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 105; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 106; width: 100%;"></div><div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 107; width: 100%;"></div></div></div><div style="margin-left: 5px; margin-right: 5px; z-index: 1000000; position: absolute; left: 0px; bottom: 0px;"><a target="_blank" href="https://maps.google.com/maps?ll=0,0&z=0&t=h&hl=en-US&gl=US&mapclient=apiv3" title="Click to see this area on Google Maps" style="position: static; overflow: visible; float: none; display: inline;"><div style="width: 62px; height: 26px; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/google_white2_hdpi.png" draggable="false" style="position: absolute; left: 0px; top: 0px; width: 62px; height: 26px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></a></div><div class="gmnoprint" style="z-index: 1000001; position: absolute; right: 0px; bottom: 0px; width: 12px;"><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a style="color: rgb(68, 68, 68); text-decoration: none; cursor: pointer; display: none;">Map Data</a><span style="display: none;"></span></div></div></div><div style="padding: 15px 21px; border: 1px solid rgb(171, 171, 171); font-family: Roboto, Arial, sans-serif; color: rgb(34, 34, 34); -webkit-box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; z-index: 10000002; display: none; width: 0px; height: 0px; position: absolute; left: 5px; top: 5px; background-color: white;"><div style="padding: 0px 0px 10px; font-size: 16px;">Map Data</div><div style="font-size: 13px;"></div><div style="width: 13px; height: 13px; overflow: hidden; position: absolute; opacity: 0.7; right: 12px; top: 12px; z-index: 10000; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6.png" draggable="false" style="position: absolute; left: -2px; top: -336px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoscreen" style="position: absolute; right: 0px; bottom: 0px;"><div style="font-family: Roboto, Arial, sans-serif; font-size: 11px; color: rgb(68, 68, 68); direction: ltr; text-align: right; background-color: rgb(245, 245, 245);"></div></div><div class="gmnoprint gm-style-cc" draggable="false" style="z-index: 1000001; position: absolute; -webkit-user-select: none; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a href="https://www.google.com/intl/en-US_US/help/terms_maps.html" target="_blank" style="text-decoration: none; cursor: pointer; color: rgb(68, 68, 68);">Terms of Use</a></div></div><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; display: none; position: absolute; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><a target="_new" title="Report errors in the road map or imagery to Google" href="https://www.google.com/maps/@0,0,0z/data=!3m1!1e3!10m1!1e1!12b1?source=apiv3&rapsrc=apiv3" style="font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); text-decoration: none; position: relative;">Report a map error</a></div></div><div class="gmnoprint" draggable="false" controlwidth="32" controlheight="84" style="margin: 5px; -webkit-user-select: none; position: absolute; left: 0px; top: 0px;"><div controlwidth="32" controlheight="40" style="cursor: url(http://maps.gstatic.com/mapfiles/openhand_8_8.cur) 8 8, default; position: absolute; left: 0px; top: 0px;"><div aria-label="Street View Pegman Control" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -9px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Pegman is disabled" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -107px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Pegman is on top of the Map" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -58px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div aria-label="Street View Pegman Control" style="width: 32px; height: 40px; overflow: hidden; position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/cb_scout2_hdpi.png" draggable="false" style="position: absolute; left: -205px; top: -102px; width: 1028px; height: 214px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoprint" controlwidth="0" controlheight="0" style="opacity: 0.6; display: none; position: absolute;"><div title="Rotate map 90 degrees" style="width: 22px; height: 22px; overflow: hidden; position: absolute; cursor: pointer;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6_hdpi.png" draggable="false" style="position: absolute; left: -38px; top: -360px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div></div><div class="gmnoprint" controlwidth="20" controlheight="39" style="position: absolute; left: 6px; top: 45px;"><div style="width: 20px; height: 39px; overflow: hidden; position: absolute;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/mapcnt6_hdpi.png" draggable="false" style="position: absolute; left: -39px; top: -401px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;"></div><div title="Zoom in" style="position: absolute; left: 0px; top: 2px; width: 20px; height: 17px; cursor: pointer;"></div><div title="Zoom out" style="position: absolute; left: 0px; top: 19px; width: 20px; height: 17px; cursor: pointer;"></div></div></div><div class="gmnoprint gm-style-mtc" style="margin: 5px; z-index: 0; position: absolute; cursor: pointer; text-align: left; width: 85px; right: 0px; top: 0px;"><div draggable="false" title="Change map style" style="direction: ltr; overflow: hidden; text-align: left; position: relative; color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 1px 6px; border-radius: 2px; -webkit-background-clip: padding-box; border: 1px solid rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; font-weight: 500; background-color: rgb(255, 255, 255); background-clip: padding-box;">Satellite<img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/arrow-down.png" draggable="false" style="-webkit-user-select: none; border: 0px; padding: 0px; margin: -2px 0px 0px; position: absolute; right: 6px; top: 50%; width: 7px; height: 4px;"></div><div style="z-index: -1; padding-top: 2px; -webkit-background-clip: padding-box; border-width: 0px 1px 1px; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-right-color: rgba(0, 0, 0, 0.14902); border-bottom-color: rgba(0, 0, 0, 0.14902); border-left-color: rgba(0, 0, 0, 0.14902); -webkit-box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; box-shadow: rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px; position: relative; text-align: left; display: none; background-color: white; background-clip: padding-box;"><div draggable="false" title="Show street map" style="color: black; font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px; background-color: rgb(255, 255, 255);">Map</div><div draggable="false" title="Show satellite imagery" style="color: black; font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px; font-weight: 500; background-color: rgb(255, 255, 255);">Satellite</div><div style="margin: 1px 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(235, 235, 235);"></div><div draggable="false" title="Show street map with terrain" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; display: none; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden; display: none;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">Terrain</label></div><div style="margin: 1px 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(235, 235, 235); display: none;"></div><div draggable="false" title="Show 45 degree view" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden; display: none;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">45°</label></div><div draggable="false" title="Show imagery with street names" style="color: rgb(0, 0, 0); font-family: Roboto, Arial, sans-serif; -webkit-user-select: none; font-size: 11px; padding: 3px 8px 3px 3px; direction: ltr; text-align: left; white-space: nowrap; background-color: rgb(255, 255, 255);"><span role="checkbox" style="box-sizing: border-box; position: relative; line-height: 0; font-size: 0px; margin: 0px 5px 0px 0px; display: inline-block; border: 1px solid rgb(198, 198, 198); border-radius: 1px; width: 13px; height: 13px; vertical-align: middle; background-color: rgb(255, 255, 255);"><div style="position: absolute; left: 1px; top: -2px; width: 13px; height: 11px; overflow: hidden;"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/imgs8.png" draggable="false" style="position: absolute; left: -52px; top: -44px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px; width: 68px; height: 67px;"></div></span><label style="vertical-align: middle; cursor: pointer;">Labels</label></div></div></div><div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; position: absolute; right: 0px; bottom: 0px;"><div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;"><div style="width: 1px;"></div><div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);"></div></div><div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;"><span>10000 km&nbsp;</span><div style="position: relative; display: inline-block; height: 8px; bottom: -1px; width: 64px;"><div style="width: 100%; height: 4px; position: absolute; bottom: 0px; left: 0px; background-color: rgb(255, 255, 255);"></div><div style="position: absolute; left: 0px; top: 0px; width: 4px; height: 8px; background-color: rgb(255, 255, 255);"></div><div style="width: 4px; height: 8px; position: absolute; bottom: 0px; right: 0px; background-color: rgb(255, 255, 255);"></div><div style="position: absolute; height: 2px; bottom: 1px; right: 1px; left: 1px; background-color: rgb(102, 102, 102);"></div><div style="position: absolute; left: 1px; top: 1px; width: 2px; height: 6px; background-color: rgb(102, 102, 102);"></div><div style="width: 2px; height: 6px; position: absolute; bottom: 1px; right: 1px; background-color: rgb(102, 102, 102);"></div></div></div></div></div></div>
        <p>&nbsp;</p>
    </fieldset>
</form>

<p>Key to calculations of rhumb lines is the <i>inverse Gudermannian
    function</i><a href="http://mathworld.wolfram.com/InverseGudermannian.html" target="_blank">¹</a>, which gives
    the height on a Mercator projection map of a given latitude:
    <span class="formula">ln(tanφ + secφ)</span> or <span class="formula">ln( tan(π/4+φ/2) )</span>.
    This of course tends to infinity at the poles (in keeping with the Mercator projection).
    <span class="grey">For obsessives, there is even an ellipsoidal version, the ‘isometric latitude’:
    <span class="formula">ψ = ln( tan(π/4+φ/2) / [ (1−e⋅sinφ) / (1+e⋅sinφ)&nbsp;]<sup>e/2</sup>)</span>,
    or its better-conditioned equivalent <span class="formula">ψ = atanh(sinφ) − e⋅atanh(e⋅sinφ)</span>.</span>
</p>
<p>The formulæ to derive Mercator projection easting and northing coordinates from spherical latitude
    and longitude are then<a href="http://www.epsg.org/guides/docs/g7-2.pdf" target="_blank">¹</a></p>
<table class="width-full">
    <tbody><tr>
        <td></td>
        <td class="formula">E = R ⋅ λ</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">N = R ⋅ ln( tan(π/4 + φ/2) )</td>
    </tr>
</tbody></table>
<p>The following formulæ are from Ed Williams’ aviation formulary.<a href="http://williams.best.vwh.net/avform.htm#Rhumb" target="_blank">¹</a></p>

<h4>Distance</h4>

<p>Since a rhumb line is a straight line on a Mercator projection, the distance between two points
    along a rhumb line is the length of that line (by Pythagoras); but the distortion of the
    projection needs to be compensated for.</p>
<p>On a constant latitude course (travelling east-west), this compensation is simply
    <span class="formula">cosφ</span>; in the general case, it is <span class="formula">Δφ/Δψ</span>
    where <span class="formula">Δψ = ln( tan(π/4 + φ<sub>2</sub>/2) / tan(π/4 + φ<sub>1</sub>/2) )</span>
    (the ‘projected’ latitude difference)</p>
<table class="width-full">
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">Δψ = ln( tan(π/4 + φ<sub>2</sub>/2) / tan(π/4 + φ<sub>1</sub>/2) )</td>
        <td class="small grey align-right">(‘projected’ latitude difference)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">q = Δφ/Δψ (or cosφ for E-W line)</td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">d = √<span class="radicand">(Δφ² + q²⋅Δλ²)</span> ⋅ R</td>
        <td class="small grey align-right">(Pythagoras)</td>
    </tr>
    <tr>
        <td class="label align-right">where</td>
        <td colspan="2">φ <i>is latitud</i>e, λ <i>is longitude</i>,
            Δλ<i> is taking shortest route (&lt;180°),
            </i>R<i> is the earth’s radius</i>, ln<i> is natural log</i></td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td colspan="2"><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> q </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δψ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">10e-12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ/Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// E-W course becomes ill-conditioned with 0/0</span></span><span class="pln"><span class="pln">

</span></span><span class="com"><span class="com">// if dLon over 180° take shorter rhumb across anti-meridian:</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">+Δλ);</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> dist </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(Δφ*Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> q</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">q</span></span><span class="pun"><span class="pun">*Δλ*Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span></pre>
        </td>
    </tr>
</tbody></table>

<h4>Bearing</h4>

<p>A rhumb line is a straight line on a Mercator projection, with an angle on the projection equal
    to the compass bearing.</p>

<table class="width-full">
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">Δψ = ln( tan(π/4 + φ<sub>2</sub>/2) / tan(π/4 + φ<sub>1</sub>/2) )</td>
        <td class="small grey align-right">(‘projected’ latitude difference)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">θ = atan2(Δλ, Δψ)</td>
        <td></td>
    </tr>
    <tr>
        <td class="label align-right">where</td>
        <td colspan="2">φ <i>is latitud</i>e, λ <i>is longitude</i>,
            Δλ<i> is taking shortest route (&lt;180°),
            </i>R<i> is the earth’s radius</i>, ln<i> is natural log</i></td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td colspan="2"><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> q </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δψ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">10e-12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ/Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// E-W course becomes ill-conditioned with 0/0</span></span><span class="pln"><span class="pln">

</span></span><span class="com"><span class="com">// if dLon over 180° take shorter rhumb across anti-meridian:</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">+Δλ);</span></span><span class="pln"><span class="pln">

            </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> brng </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(Δλ,</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ).</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">();</span></span></pre></td>
    </tr>
</tbody></table>

<h4>Destination</h4>

<p>Given a start point and a distance <i>d</i> along constant bearing <i>θ</i>, this will calculate
    the destination point. If you maintain a constant bearing along a rhumb line, you will gradually
    spiral in towards one of the poles. </p>
<table class="width-full">
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">δ = d/R</td>
        <td class="small grey align-right">(angular distance)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">Δψ = ln( tan(π/4 + φ<sub>2</sub>/2) / tan(π/4 + φ<sub>1</sub>/2) )</td>
        <td class="small grey align-right">(‘projected’ latitude difference)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">q = Δφ/Δψ (or cosφ for E-W line)</td>
        <td class="formula">&nbsp;</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">Δλ = δ ⋅ sin θ / q</td>
        <td class="formula">&nbsp;</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">φ<sub>2</sub> = φ<sub>1</sub> + δ ⋅ cos θ</td>
        <td class="formula">&nbsp;</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">λ<sub>2</sub> = λ<sub>1</sub> + Δλ</td>
        <td class="formula">&nbsp;</td>
    </tr>
    <tr>
        <td class="label align-right">where</td>
        <td colspan="2">φ <i>is latitude</i>, λ <i>is longitude</i>, Δλ <i>is taking shortest route
            (&lt;180°), </i>ln<i> is natural log, </i>R<i> is the earth’s radius</i></td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td colspan="2"><pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(θ);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ;</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> q </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">10e-12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// E-W course becomes ill-conditioned with 0/0</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ)/</span></span><span class="pln"><span class="pln">q</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

</span></span><span class="com"><span class="com">// check for some daft bugger going past the pole, normalise latitude if so</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

</span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">dLon</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)%(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span></pre></td>
  </tr>
</tbody></table>

<h4>Mid-point</h4>

<p>This formula for calculating the ‘loxodromic midpoint’, the point half-way along a rhumb line
    between two points, is due to Robert Hill and Clive
    Tooth<sup><a href="http://mathforum.org/kb/message.jspa?messageID=148837" target="_blank">1</a></sup> (thx
    Axel!).</p>

<table>
    <tbody><tr>
        <td class="label">Formula: </td>
        <td class="formula">φ<sub>m</sub> = (φ<sub>1</sub>+φ<sub>2</sub>) / 2</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">f<sub>1</sub> = tan(π/4 + φ<sub>1</sub>/2)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">f<sub>2</sub> = tan(π/4 + φ<sub>2</sub>/2)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">f<sub>m</sub> = tan(π/4+φ<sub>m</sub>/2)</td>
    </tr>
    <tr>
        <td></td>
        <td class="formula">λ<sub>m</sub> = [ (λ<sub>2</sub>−λ<sub>1</sub>) ⋅ ln(f<sub>m</sub>) +
            λ<sub>1</sub> ⋅ ln(f<sub>2</sub>) − λ<sub>2</sub> ⋅ ln(f<sub>1</sub>) ] /
            ln(f<sub>2</sub>/f<sub>1</sub>)</td>
    </tr>
    <tr>
        <td class="label align-right">where</td>
        <td>φ <i>is latitude</i>, λ <i>is longitude</i>, ln <i>is natural log</i></td>
    </tr>
    <tr>
        <td class="label">JavaScript:<div class="small grey">(all angles <br>in radians)</div></td>
        <td>
            <pre class="code prettyprint margin-l-0"><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// crossing anti-meridian</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> f1 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> f2 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> f3 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f2</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">f1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!</span></span><span class="pln"><span class="pln">isFinite</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">+λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// parallel of latitude</span></span><span class="pln"><span class="pln">

</span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">+</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">  </span></span><span class="com"><span class="com">// normalise to -180..+180°</span></span><span class="pln"><span class="pln">
            </span></span></pre>
        </td>
    </tr>
</tbody></table>
<hr>

<h3 id="using">Using the scripts in web pages</h3>

<p>Using these scripts in web pages would be something like the following:</p>
<pre class="prettyprint"><span class="tag"><span class="tag">&lt;script</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">src</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"latlon.js"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="com"><span class="com">/* Latitude/Longitude formulae */</span></span><span class="tag"><span class="tag">&lt;/script&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;script</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">src</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"dms.js"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="com"><span class="com">/* Geodesy representation conversions */</span></span><span class="tag"><span class="tag">&lt;/script&gt;</span></span><span class="pln"><span class="pln">
...
</span></span><span class="tag"><span class="tag">&lt;form&gt;</span></span><span class="pln"><span class="pln">
  Lat1: </span></span><span class="tag"><span class="tag">&lt;input</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"text"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">name</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lat1"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lat1"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln"> Lon1: </span></span><span class="tag"><span class="tag">&lt;input</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"text"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">name</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lon1"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lon1"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
  Lat2: </span></span><span class="tag"><span class="tag">&lt;input</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"text"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">name</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lat2"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lat2"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln"> Lon2: </span></span><span class="tag"><span class="tag">&lt;input</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"text"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">name</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lon2"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lon2"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
  </span></span><span class="tag"><span class="tag">&lt;button</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">onClick</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"</span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> p1 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parseDMS</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">value</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parseDMS</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">value</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
                   </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> p2 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parseDMS</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">value</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parseDMS</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">value</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
                   alert</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">distanceTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p2</span></span><span class="pun"><span class="pun">));</span></span><span class="atv"><span class="atv">"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">Calculate distance</span></span><span class="tag"><span class="tag">&lt;/button&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;/form&gt;</span></span></pre>
<p>If you use jQuery, the code can be separated from the HTML:</p>
    <pre class="prettyprint"><span class="tag"><span class="tag">&lt;script</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">src</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"</span></span><span class="tag"><span class="tag">&gt;&lt;/script&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;script</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">src</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"latlon.js"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="com"><span class="com">/* Latitude/Longitude formulae */</span></span><span class="tag"><span class="tag">&lt;/script&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;script</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">src</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"dms.js"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="com"><span class="com">/* Geodesy representation conversions */</span></span><span class="tag"><span class="tag">&lt;/script&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;script&gt;</span></span><span class="pln"><span class="pln">
  $</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">document</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">ready</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    $</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'#calc-dist'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">click</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
      </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> p1 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parseDMS</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">$</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'#lat1'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">val</span></span><span class="pun"><span class="pun">()),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parseDMS</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">$</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'#lon1'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">val</span></span><span class="pun"><span class="pun">()));</span></span><span class="pln"><span class="pln">
      </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> p2 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parseDMS</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">$</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'#lat2'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">val</span></span><span class="pun"><span class="pun">()),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">parseDMS</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">$</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'#lon2'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">val</span></span><span class="pun"><span class="pun">()));</span></span><span class="pln"><span class="pln">
      $</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'#result-distance'</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">html</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">distanceTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p2</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">});</span></span><span class="pln"><span class="pln">
  </span></span><span class="pun"><span class="pun">});</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;/script&gt;</span></span><span class="pln"><span class="pln">
...
</span></span><span class="tag"><span class="tag">&lt;form&gt;</span></span><span class="pln"><span class="pln">
  Lat1: </span></span><span class="tag"><span class="tag">&lt;input</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"text"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">name</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lat1"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lat1"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln"> Lon1: </span></span><span class="tag"><span class="tag">&lt;input</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"text"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">name</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lon1"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lon1"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
  Lat2: </span></span><span class="tag"><span class="tag">&lt;input</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"text"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">name</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lat2"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lat2"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln"> Lon2: </span></span><span class="tag"><span class="tag">&lt;input</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">type</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"text"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">name</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lon2"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"lon2"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
  </span></span><span class="tag"><span class="tag">&lt;button</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"calc-dist"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">Calculate distance</span></span><span class="tag"><span class="tag">&lt;/button&gt;</span></span><span class="pln"><span class="pln">
  </span></span><span class="tag"><span class="tag">&lt;output</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">id</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"result-distance"</span></span><span class="tag"><span class="tag">&gt;&lt;/output&gt;</span></span><span class="pln"><span class="pln"> km
</span></span><span class="tag"><span class="tag">&lt;/form&gt;</span></span></pre>
<hr>
    
<h3 id="convertDecDMS">Convert between degrees-minutes-seconds &amp; decimal degrees</h3>

<form name="convert" id="convert">
    <table class="note">
        <tbody><tr>
            <td>Latitude</td>
            <td>Longitude</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td><input type="text" name="latD" id="latD" value="52.20472°N" class="note w8"></td>
            <td><input type="text" name="lonD" id="lonD" value="000.14056°E" class="note w8"></td>
            <td colspan="2">1° ≈ 111 km <span class="grey">(110.57 eq’l — 111.70 polar)</span></td>
        </tr>
        <tr>
            <td><input type="text" name="latDM" id="latDM" value="52°12.283′N" class="note w8"></td>
            <td><input type="text" name="lonDM" id="lonDM" value="000°08.433′E" class="note w8"></td>
            <td>1′ ≈ 1.85 km <span class="grey">(= 1 nm)</span></td>
            <td>0.01° ≈ 1.11 km</td>
        </tr>
        <tr>
            <td><input type="text" name="latDMS" id="latDMS" value="52°12′17.0″N" class="note w8"></td>
            <td><input type="text" name="lonDMS" id="lonDMS" value="000°08′26.0″E" class="note w8"></td>
            <td>1″ ≈ 30.9 m</td>
            <td>0.0001° ≈ 11.1 m</td>
        </tr>
    </tbody></table>
</form>

<form>Display calculation results as:
    <input type="radio" name="deg-format" id="deg-format-d" value="d"> <span title="decimal">degrees</span>
    <input type="radio" name="deg-format" id="deg-format-dm" value="dm"> <span title="sow’s ear">deg/min</span>
    <input type="radio" name="deg-format" id="deg-format-dms" value="dms" checked="checked"> <span title="sexagesimal">deg/min/sec</span>
</form>

<hr>

<p id="notes"><i>Notes:</i></p>
<ul class="note">
    <li id="ellipsoid">Accuracy: since the earth is not quite a sphere, there are small errors in
        using spherical geometry; the earth is actually roughly <b>ellipsoidal</b> (or more precisely,
        oblate spheroidal) with a radius varying between about 6,378km (equatorial) and 6,357km (polar),
        and local radius of curvature varying from 6,336km (equatorial meridian) to 6,399km (polar).
        6,371 km is the generally accepted value for the earth’s mean radius. This means that errors
        from assuming spherical geometry might be up to 0.55% crossing the equator, though generally
        below 0.3%, depending on latitude and direction of travel. An accuracy of better than 3m in
        1km is mostly good enough for me, but if you want greater accuracy, you could use the
        <a href="http://www.movable-type.co.uk/scripts/latlong-vincenty.html">Vincenty</a> formula for calculating geodesic distances on
        ellipsoids, which gives results accurate to within 1mm. (Out of sheer perversity – I’ve never
        needed such accuracy – I looked up this formula and discovered the JavaScript implementation
        was simpler than I expected).</li>
    <li>Trig functions take arguments in <b>radians</b>, so latitude, longitude, and bearings in
        <b>degrees</b> (either decimal or degrees/minutes/seconds) need to be converted to radians,
        rad = π.deg/180. When converting radians back to degrees (deg = 180.rad/π), West is negative
        if using signed decimal degrees. For bearings, values in the range -π to +π [-180° to +180°]
        need to be converted to 0 to +2π [0°–360°]; this can  be done by (brng+2.π)%2.π [or
        brng+360)%360] where % is the (floating point) modulo operator.</li>
    <li>The <b>atan2</b>() function widely used here takes two arguments, atan2(y, x), and computes
        the arc tangent of the ratio y/x. It is more flexible than atan(y/x), since it handles x=0,
        and it also returns values in all 4 quadrants -π to +π (the atan function returns values
        in the range -π/2 to +π/2).</li>
    <li>All bearings are with respect to <b>true north</b>, 0°=N, 90°=E, etc; if you are working
        from a compass, magnetic north varies from true north in a complex way around the earth,
        and the difference has to be compensated for by variances indicated on local maps.</li>
    <li>If you implement any formula involving atan2 in Microsoft <b>Excel</b>, you will need to
        reverse  the arguments, as <a href="http://office.microsoft.com/en-gb/excel/HP052089911033.aspx" target="_blank">Excel</a>
        has them the opposite way around from <a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Math/atan2" target="_blank">JavaScript</a>
        – conventional order is atan2(y, x), but Excel uses atan2(x, y). To use atan2 in a (VBA) macro,
        you can use WorksheetFunction.Atan2(). </li>
    <li>If you are using <b>Google Maps</b>, several of these functions are now provided in the Google
        Maps API V3 ‘spherical’ library (computeDistanceBetween(), computeHeading(), computeOffset(),
        interpolate(), etc; note they use a default Earth radius of 6,378,137 meters).</li>
    <li>If you use Ordnance Survey Grid References, I have implemented a script for <a href="http://www.movable-type.co.uk/scripts/latlong-gridref.html">converting
        between Lat/Long &amp; OS Grid References</a>.</li>
    <li>I learned a lot from the US Census Bureau <a href="http://www.movable-type.co.uk/scripts/gis-faq-5.1.html">GIS FAQ</a> which is no
        longer available, so I’ve made a copy.</li>
    <li>Thanks to Ed Williams’ <a href="http://williams.best.vwh.net/avform.htm" target="_blank">Aviation Formulary</a>
        for many of the formulæ.</li>
    <li>For <b>miles</b>, divide km by 1.609344</li>
    <li>For <b>nautical miles</b>, divide km by 1.852</li>
</ul>

<hr class="fullwidth">

<p id="postscript">See below for the JavaScript source code,
    also available on <a href="https://github.com/chrisveness/geodesy/blob/master/latlon.js" target="_blank">GitHub</a>.
    Note I use Greek letters in variables representing maths symbols conventionally presented as Greek letters:
    I value the great benefit in legibility over the minor inconvenience in typing (if you
    encounter any problems, ensure your <code>&lt;head&gt;</code> includes <code>&lt;meta charset="utf-8"&gt;</code>).</p>
<p>With its untyped C-style syntax, JavaScript reads remarkably close to pseudo-code: exposing the
    algorithms with a minimum of syntactic distractions. These functions should be simple to
    translate into other languages if required, though can also be used as-is in browsers and Node.js.</p>
<p>I have extended base JavaScript object prototypes with trim(), toRadians(), and toDegrees() methods:
    I don’t see great likelihood of conflicts; trim() is now in the language, and degree/radian conversion is ubiquitous.</p>
<p>I also have a page illustrating the use of the spherical law of cosines for <a href="http://www.movable-type.co.uk/scripts/latlong-db.html">selecting
    points from a database</a> within a specified bounding circle – the example is based on MySQL+PDO,
    but should be extensible to other DBMS platforms.</p>
<p id="spreadsheets">Several people have asked about  example <b>Excel</b> spreadsheets, so I have implemented the
    <a href="http://www.movable-type.co.uk/scripts/latlong-distance+bearing.xls">distance &amp; bearing</a> and the <a href="http://www.movable-type.co.uk/scripts/latlong-dest-point.xls">destination
    point</a> formulæ as spreadsheets, in a form which breaks down the all stages involved to illustrate
    the operation.</p>
<p><i>January 2010</i>: I have revised the scripts to be structured as methods of a LatLon object.
    Of course, while JavaScript is <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript" target="_blank">object-oriented</a>,
    it is a <a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Details_of_the_Object_Model" target="_blank">prototype-based
    rather than class-based</a> language, so this is not actually a class, but isolating code into a separate namespace
    is good JavaScript practice.
    If you’re not familiar with JavaScript syntax, <code>LatLon.prototype.distanceTo = function(point)
    { ... }</code>, for instance, defines a ‘<code>distanceTo</code>’ method of the <code>LatLon</code> object
    (/class) which takes a <code>LatLon</code> object as a parameter (and returns a number). The
    <i>Dms</i> namespace acts as a static class for geodesy formatting / parsing / conversion functions.</p>
<p><i>January 2015</i>: I have refactored the scripts to inter-operate better, and rationalised certain aspects: the
    JavaScript file is now latlon-spherical.js instead of simply latlon.js; distances are now always in metres; the earth’s
    radius is now a parameter to distance calculation methods rather than to the constructor; the
    previous <code>Geo</code> object is now <code>Dms</code>, to better indicate its purpose; the
    <code>destinationPoint</code> function has the distance parameter before the bearing.</p>
<p id="licence"><a href="http://opensource.org/licenses/MIT" class="float-right" target="_blank"><img src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/license-osi-mit.png" alt="OSI MIT License"></a>
    I offer these scripts for free use and adaptation to balance my debt to the open-source info-verse.
    You are welcome to re-use these scripts [under an <a href="http://opensource.org/licenses/MIT" target="_blank">MIT</a> licence,
    without any warranty express or implied] provided solely that you retain my copyright notice and a link to this page.</p>
<p id="donate"><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=3737803" class="float-right" target="_blank">
        <img alt="Paypal donation" style="margin:4px" src="./Calculate distance and bearing between two Latitude_Longitude points using haversine formula in JavaScript_files/btn_donate_SM.gif"></a>
    If you would like to show your appreciation and support continued development of these scripts,
    I would most gratefully accept <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=3737803" title="Thank you!" target="_blank">donations</a>.</p>
<p>If you need any advice or development work done, I am available for consultancy.</p>
<p>If you have any queries or find any problems, contact me at <span class="rtl"><a href="mailto:scripts-geo@movable-type.co.uk" rel="nofollow">ku.oc.epyt-elbavom@oeg-stpircs</a></span>.</p>
<p class="note"><i>© 2002-2015 Chris Veness</i></p>
</main>

<hr class="fullwidth">
<pre class="fullwidth code prettyprint" id="latlon-src"><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/*  Latitude/longitude spherical geodesy formulae &amp; scripts           (c) Chris Veness 2002-2015  */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/*   - www.movable-type.co.uk/scripts/latlong.html                                   MIT Licence  */</span></span><span class="pln"><span class="pln">
</span></span><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">

</span></span><span class="str"><span class="str">'use strict'</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">typeof</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">module</span></span><span class="pun"><span class="pun">!=</span></span><span class="str"><span class="str">'undefined'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">module</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">exports</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">require</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'./dms'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// CommonJS (Node)</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Creates a LatLon point on the earth's surface at the specified latitude / longitude.
 *
 * @classdesc Tools for geodetic calculations
 * @requires Dms from 'dms.js'
 *
 * @constructor
 * @param {number} lat - Latitude in degrees.
 * @param {number} lon - Longitude in degrees.
 *
 * @example
 *     var p1 = new LatLon(52.205, 0.119);
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">function</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="com"><span class="com">// allow instantiation without 'new'</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns the distance from 'this' point to destination point (using haversine formula).
 *
 * @param   {LatLon} point - Latitude/longitude of destination point.
 * @param   {number} [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
 * @returns {number} Distance between this point and destination point, in same units as radius.
 *
 * @example
 *     var p1 = new LatLon(52.205, 0.119), p2 = new LatLon(48.857, 2.351);
 *     var d = p1.distanceTo(p2); // Number(d.toPrecision(4)): 404300
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">distanceTo </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'point is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    radius </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius </span></span><span class="pun"><span class="pun">===</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln">  </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> a </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">
            </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">
            </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> c </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">a</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> d </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> c</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> d</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns the (initial) bearing from 'this' point to destination point.
 *
 * @param   {LatLon} point - Latitude/longitude of destination point.
 * @returns {number} Initial bearing in degrees from north.
 *
 * @example
 *     var p1 = new LatLon(52.205, 0.119), p2 = new LatLon(48.857, 2.351);
 *     var b1 = p1.bearingTo(p2); // b1.toFixed(1): 156.2
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">bearingTo </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'point is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">-</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// see http://mathforum.org/library/drmath/view/55417.html</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> y </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> x </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln">
            </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(Δλ);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">y</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> x</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(θ.</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">()+</span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns final bearing arriving at destination destination point from 'this' point; the final bearing
 * will differ from the initial bearing by varying degrees according to distance and latitude.
 *
 * @param   {LatLon} point - Latitude/longitude of destination point.
 * @returns {number} Final bearing in degrees from north.
 *
 * @example
 *     var p1 = new LatLon(52.205, 0.119), p2 = new LatLon(48.857, 2.351);
 *     var b2 = p1.finalBearingTo(p2); // b2.toFixed(1): 157.9
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">finalBearingTo </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'point is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// get initial bearing from destination point to this point &amp; reverse it by adding 180°</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">bearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">)+</span></span><span class="lit"><span class="lit">180</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns the midpoint between 'this' point and the supplied point.
 *
 * @param   {LatLon} point - Latitude/longitude of destination point.
 * @returns {LatLon} Midpoint between this point and the supplied point.
 *
 * @example
 *     var p1 = new LatLon(52.205, 0.119), p2 = new LatLon(48.857, 2.351);
 *     var pMid = p1.midpointTo(p2); // pMid.toString(): 50.5363°N, 001.2746°E
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">midpointTo </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'point is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// see http://mathforum.org/library/drmath/view/51822.html for derivation</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">-</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Bx</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(Δλ);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">By</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln">
             </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)+</span></span><span class="typ"><span class="typ">Bx</span></span><span class="pun"><span class="pun">)*(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)+</span></span><span class="typ"><span class="typ">Bx</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">By</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">By</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">By</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Bx</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">+</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// normalise to -180..+180°</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">());</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns the destination point from 'this' point having travelled the given distance on the
 * given initial bearing (bearing normally varies around path followed).
 *
 * @param   {number} distance - Distance travelled, in same units as earth radius (default: metres).
 * @param   {number} bearing - Initial bearing in degrees from north.
 * @param   {number} [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
 * @returns {LatLon} Destination point.
 *
 * @example
 *     var p1 = new LatLon(51.4778, -0.0015);
 *     var p2 = p1.destinationPoint(7794, 300.7); // p2.toString(): 51.5135°N, 000.0983°W
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">destinationPoint </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">distance</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> bearing</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    radius </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius </span></span><span class="pun"><span class="pun">===</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// see http://williams.best.vwh.net/avform.htm#LL</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">distance</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// angular distance in radians</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">
                        </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(θ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln">
                             </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ)-</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// normalise to -180..+180°</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2.toDegrees</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2.toDegrees</span></span><span class="pun"><span class="pun">());</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns the point of intersection of two paths defined by point and bearing.
 *
 * @param   {LatLon} p1 - First point.
 * @param   {number} brng1 - Initial bearing from first point.
 * @param   {LatLon} p2 - Second point.
 * @param   {number} brng2 - Initial bearing from second point.
 * @returns {LatLon} Destination point (null if no unique intersection defined).
 *
 * @example
 *     var p1 = LatLon(51.8853, 0.2545), brng1 = 108.547;
 *     var p2 = LatLon(49.0034, 2.5735), brng2 =  32.435;
 *     var pInt = LatLon.intersection(p1, brng1, p2, brng2); // pInt.toString(): 50.9078°N, 004.5084°E
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">intersection </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">p1</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> brng1</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> p2</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> brng2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">p1 </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'p1 is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">p2 </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'p2 is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// see http://williams.best.vwh.net/avform.htm#Intersection</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p1</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> p2</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">brng1</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">23</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">brng2</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δφ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">
        </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(Δλ/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// initial/final bearings between points</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">
                        </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">isNaN</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// protect against rounding</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">
                        </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">21</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">21</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">else</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
        </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">21</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">α</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// angle 2-1-3</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">α</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">21</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">23</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// angle 1-2-3</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)==</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)==</span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// infinite intersections</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&lt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">0</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">null</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">      </span></span><span class="com"><span class="com">// ambiguous intersection</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">//α1 = Math.abs(α1);</span></span><span class="pln"><span class="pln">
    </span></span><span class="com"><span class="com">//α2 = Math.abs(α2);</span></span><span class="pln"><span class="pln">
    </span></span><span class="com"><span class="com">// ... Ed Williams takes abs of α1/α2, but seems to break calculation?</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">α</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">acos</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">
                         </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln">
                          </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(α</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln">
                        </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">),</span></span><span class="pln"><span class="pln">
                           </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)-</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">+</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// normalise to -180..+180°</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">());</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns (signed) distance from ‘this’ point to great circle defined by start-point and end-point.
 *
 * @param   {LatLon} pathStart - Start point of great circle path.
 * @param   {LatLon} pathEnd - End point of great circle path.
 * @param   {number} [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
 * @returns {number} Distance to great circle (-ve if to left, +ve if to right of path).
 *
 * @example
 *   var pCurrent = new LatLon(53.2611, -0.7972);
 *   var p1 = new LatLon(53.3206, -1.7297), p2 = new LatLon(53.1887, 0.1334);
 *   var d = pCurrent.crossTrackDistanceTo(p1, p2);  // Number(d.toPrecision(4)): -307.5
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">crossTrackDistanceTo </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">pathStart</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> pathEnd</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">pathStart </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'pathStart is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">pathEnd </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'pathEnd is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    radius </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius </span></span><span class="pun"><span class="pun">===</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> pathStart</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">distanceTo</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">)/</span></span><span class="pln"><span class="pln">radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> pathStart</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">bearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> pathStart</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">bearingTo</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">pathEnd</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> dxt </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">asin</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(δ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ</span></span><span class="lit"><span class="lit">13</span></span><span class="pun"><span class="pun">-θ</span></span><span class="lit"><span class="lit">12</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> dxt</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">

</span></span><span class="com"><span class="com">/**
 * Returns the distance travelling from 'this' point to destination point along a rhumb line.
 *
 * @param   {LatLon} point - Latitude/longitude of destination point.
 * @param   {number} [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
 * @returns {number} Distance in km between this point and destination point (same units as radius).
 *
 * @example
 *     var p1 = new LatLon(51.127, 1.338), p2 = new LatLon(50.964, 1.853);
 *     var d = p1.distanceTo(p2); // Number(d.toPrecision(4)): 40310
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">rhumbDistanceTo </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'point is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    radius </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius </span></span><span class="pun"><span class="pun">===</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// see http://williams.best.vwh.net/avform.htm#Rhumb</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> R </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">-</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="com"><span class="com">// if dLon over 180° take shorter rhumb line across the anti-meridian:</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">+Δλ);</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// on Mercator projection, longitude distances shrink by latitude; q is the 'stretch factor'</span></span><span class="pln"><span class="pln">
    </span></span><span class="com"><span class="com">// q becomes ill-conditioned along E-W line (0/0); use empirical tolerance to avoid it</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> q </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δψ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">10e-12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ/Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// distance is pythagoras on 'stretched' Mercator projection</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sqrt</span></span><span class="pun"><span class="pun">(Δφ*Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> q</span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln">q</span></span><span class="pun"><span class="pun">*Δλ*Δλ);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// angular distance in radians</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> dist </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> R</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> dist</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns the bearing from 'this' point to destination point along a rhumb line.
 *
 * @param   {LatLon} point - Latitude/longitude of destination point.
 * @returns {number} Bearing in degrees from north.
 *
 * @example
 *     var p1 = new LatLon(51.127, 1.338), p2 = new LatLon(50.964, 1.853);
 *     var d = p1.rhumbBearingTo(p2); // d.toFixed(1): 116.7
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">rhumbBearingTo </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'point is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">-</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="com"><span class="com">// if dLon over 180° take shorter rhumb line across the anti-meridian:</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-Δλ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">+Δλ);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">atan2</span></span><span class="pun"><span class="pun">(Δλ,</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(θ.</span></span><span class="pln"><span class="pln">toDegrees</span></span><span class="pun"><span class="pun">()+</span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">360</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns the destination point having travelled along a rhumb line from 'this' point the given
 * distance on the  given bearing.
 *
 * @param   {number} distance - Distance travelled, in same units as earth radius (default: metres).
 * @param   {number} bearing - Bearing in degrees from north.
 * @param   {number} [radius=6371e3] - (Mean) radius of earth (defaults to radius in metres).
 * @returns {LatLon} Destination point.
 *
 * @example
 *     var p1 = new LatLon(51.127, 1.338);
 *     var p2 = p1.rhumbDestinationPoint(40300, 116.7); // p2.toString(): 50.9642°N, 001.8530°E
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">rhumbDestinationPoint </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">distance</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> bearing</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    radius </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius </span></span><span class="pun"><span class="pun">===</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">6371e3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">radius</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">distance</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> radius</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// angular distance in radians</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">θ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">bearing</span></span><span class="pun"><span class="pun">).</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(θ);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ;</span></span><span class="pln"><span class="pln">
    </span></span><span class="com"><span class="com">// check for some daft bugger going past the pole, normalise latitude if so</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">&gt;</span></span><span class="lit"><span class="lit">0</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">-φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">)/</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">+</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pun"><span class="pun">));</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> q </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(Δψ)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">10e-12</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">?</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δφ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δψ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">:</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">cos</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// E-W course becomes ill-conditioned with 0/0</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">δ*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">sin</span></span><span class="pun"><span class="pun">(θ)/</span></span><span class="pln"><span class="pln">q</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">Δλ;</span></span><span class="pln"><span class="pln">

    </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// normalise to -180..+180°</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">2.toDegrees</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2.toDegrees</span></span><span class="pun"><span class="pun">());</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns the loxodromic midpoint (along a rhumb line) between 'this' point and second point.
 *
 * @param   {LatLon} point - Latitude/longitude of second point.
 * @returns {LatLon} Midpoint between this point and second point.
 *
 * @example
 *     var p1 = new LatLon(51.127, 1.338), p2 = new LatLon(50.964, 1.853);
 *     var p2 = p1.rhumbMidpointTo(p2); // p2.toString(): 51.0455°N, 001.5957°E
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">rhumbMidpointTo </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">point</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!(</span></span><span class="pln"><span class="pln">point </span></span><span class="kwd"><span class="kwd">instanceof</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">throw</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">TypeError</span></span><span class="pun"><span class="pun">(</span></span><span class="str"><span class="str">'point is not LatLon object'</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="com"><span class="com">// http://mathforum.org/kb/message.jspa?messageID=148837</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> point</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians</span></span><span class="pun"><span class="pun">();</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">abs</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&gt;</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+=</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// crossing anti-meridian</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">+φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> f1 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> f2 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> f3 </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">tan</span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">4</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">φ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">var</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">-λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">)*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f3</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f2</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f1</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">log</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">f2</span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln">f1</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(!</span></span><span class="pln"><span class="pln">isFinite</span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">))</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">1</span></span><span class="pun"><span class="pun">+λ</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">)/</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// parallel of latitude</span></span><span class="pln"><span class="pln">

    </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(λ</span></span><span class="lit"><span class="lit">3</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">3</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">%</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="lit"><span class="lit">2</span></span><span class="pun"><span class="pun">*</span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">-</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// normalise to -180..+180°</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">new</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">(φ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">(),</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">λ</span></span><span class="lit"><span class="lit">3.toDegrees</span></span><span class="pun"><span class="pun">());</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/**
 * Returns a string representation of 'this' point, formatted as degrees, degrees+minutes, or
 * degrees+minutes+seconds.
 *
 * @param   {string} [format=dms] - Format point as 'd', 'dm', 'dms'.
 * @param   {number} [dp=0|2|4] - Number of decimal places to use - default 0 for dms, 2 for dm, 4 for d.
 * @returns {string} Comma-separated latitude/longitude.
 */</span></span><span class="pln"><span class="pln">
</span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toString </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="pln"><span class="pln">format </span></span><span class="pun"><span class="pun">===</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> format </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'dms'</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln">

    </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toLat</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lat</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">', '</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">+</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Dms</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toLon</span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">this</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">lon</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> format</span></span><span class="pun"><span class="pun">,</span></span><span class="pln"><span class="pln"> dp</span></span><span class="pun"><span class="pun">);</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/** Extend Number object with method to convert numeric degrees to radians */</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians </span></span><span class="pun"><span class="pun">===</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toRadians </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">180</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/** Extend Number object with method to convert radians to numeric (signed) degrees */</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDegrees </span></span><span class="pun"><span class="pun">===</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">undefined</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln">
    </span></span><span class="typ"><span class="typ">Number</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">prototype</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">toDegrees </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">this</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">*</span></span><span class="pln"><span class="pln"> </span></span><span class="lit"><span class="lit">180</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">/</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">Math</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">PI</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">};</span></span><span class="pln"><span class="pln">
</span></span><span class="pun"><span class="pun">}</span></span><span class="pln"><span class="pln">


</span></span><span class="com"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">typeof</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">module</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">!=</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'undefined'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">module</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">exports</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">module</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">exports </span></span><span class="pun"><span class="pun">=</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// CommonJS (Node)</span></span><span class="pln"><span class="pln">
</span></span><span class="kwd"><span class="kwd">if</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">(</span></span><span class="kwd"><span class="kwd">typeof</span></span><span class="pln"><span class="pln"> define </span></span><span class="pun"><span class="pun">==</span></span><span class="pln"><span class="pln"> </span></span><span class="str"><span class="str">'function'</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">&amp;&amp;</span></span><span class="pln"><span class="pln"> define</span></span><span class="pun"><span class="pun">.</span></span><span class="pln"><span class="pln">amd</span></span><span class="pun"><span class="pun">)</span></span><span class="pln"><span class="pln"> define</span></span><span class="pun"><span class="pun">([</span></span><span class="str"><span class="str">'Dms'</span></span><span class="pun"><span class="pun">],</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">function</span></span><span class="pun"><span class="pun">()</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">{</span></span><span class="pln"><span class="pln"> </span></span><span class="kwd"><span class="kwd">return</span></span><span class="pln"><span class="pln"> </span></span><span class="typ"><span class="typ">LatLon</span></span><span class="pun"><span class="pun">;</span></span><span class="pln"><span class="pln"> </span></span><span class="pun"><span class="pun">});</span></span><span class="pln"><span class="pln"> </span></span><span class="com"><span class="com">// AMD</span></span></pre>

<hr class="fullwidth">
<pre class="fullwidth code prettyprint" id="dms-src"><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span><span class="pln">
</span><span class="com">/*  Geodesy representation conversion functions                       (c) Chris Veness 2002-2015  */</span><span class="pln">
</span><span class="com">/*   - www.movable-type.co.uk/scripts/latlong.html                                   MIT Licence  */</span><span class="pln">
</span><span class="com">/*                                                                                                */</span><span class="pln">
</span><span class="com">/*  Sample usage:                                                                                 */</span><span class="pln">
</span><span class="com">/*    var lat = Dms.parseDMS('51° 28′ 40.12″ N');                                                 */</span><span class="pln">
</span><span class="com">/*    var lon = Dms.parseDMS('000° 00′ 05.31″ W');                                                */</span><span class="pln">
</span><span class="com">/*    var p1 = new LatLon(lat, lon);                                                              */</span><span class="pln">
</span><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span><span class="pln">

</span><span class="str">'use strict'</span><span class="pun">;</span><span class="pln">


</span><span class="com">/**
 * Tools for converting between numeric degrees and degrees / minutes / seconds.
 *
 * @namespace
 */</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> </span><span class="typ">Dms</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">


</span><span class="com">// note Unicode Degree = U+00B0. Prime = U+2032, Double prime = U+2033</span><span class="pln">


</span><span class="com">/**
 * Parses string representing degrees/minutes/seconds into numeric degrees.
 *
 * This is very flexible on formats, allowing signed decimal degrees, or deg-min-sec optionally
 * suffixed by compass direction (NSEW). A variety of separators are accepted (eg 3° 37′ 09″W).
 * Seconds and minutes may be omitted.
 *
 * @param   {string|number} dmsStr - Degrees or deg/min/sec in variety of formats.
 * @returns {number} Degrees as decimal number.
 */</span><span class="pln">
</span><span class="typ">Dms</span><span class="pun">.</span><span class="pln">parseDMS </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">dmsStr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// check for signed decimal degrees without NSEW, if so return it directly</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">typeof</span><span class="pln"> dmsStr </span><span class="pun">==</span><span class="pln"> </span><span class="str">'number'</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> isFinite</span><span class="pun">(</span><span class="pln">dmsStr</span><span class="pun">))</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Number</span><span class="pun">(</span><span class="pln">dmsStr</span><span class="pun">);</span><span class="pln">

    </span><span class="com">// strip off any sign or compass dir'n &amp; split out separate d/m/s</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> dms </span><span class="pun">=</span><span class="pln"> </span><span class="typ">String</span><span class="pun">(</span><span class="pln">dmsStr</span><span class="pun">).</span><span class="pln">trim</span><span class="pun">().</span><span class="pln">replace</span><span class="pun">(</span><span class="str">/^-/</span><span class="pun">,</span><span class="pln"> </span><span class="str">''</span><span class="pun">).</span><span class="pln">replace</span><span class="pun">(</span><span class="str">/[NSEW]$/</span><span class="pln">i</span><span class="pun">,</span><span class="pln"> </span><span class="str">''</span><span class="pun">).</span><span class="pln">split</span><span class="pun">(</span><span class="str">/[^0-9.,]+/</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dms</span><span class="pun">[</span><span class="pln">dms</span><span class="pun">.</span><span class="pln">length</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]==</span><span class="str">''</span><span class="pun">)</span><span class="pln"> dms</span><span class="pun">.</span><span class="pln">splice</span><span class="pun">(</span><span class="pln">dms</span><span class="pun">.</span><span class="pln">length</span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">  </span><span class="com">// from trailing symbol</span><span class="pln">

    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dms </span><span class="pun">==</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">NaN</span><span class="pun">;</span><span class="pln">

    </span><span class="com">// and convert to decimal degrees...</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> deg</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dms</span><span class="pun">.</span><span class="pln">length</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span><span class="pln">  </span><span class="com">// interpret 3-part result as d/m/s</span><span class="pln">
            deg </span><span class="pun">=</span><span class="pln"> dms</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]/</span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> dms</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]/</span><span class="lit">60</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> dms</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]/</span><span class="lit">3600</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln">  </span><span class="com">// interpret 2-part result as d/m</span><span class="pln">
            deg </span><span class="pun">=</span><span class="pln"> dms</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]/</span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> dms</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]/</span><span class="lit">60</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln">  </span><span class="com">// just d (possibly decimal) or non-separated dddmmss</span><span class="pln">
            deg </span><span class="pun">=</span><span class="pln"> dms</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
            </span><span class="com">// check for fixed-width unseparated format eg 0033709W</span><span class="pln">
            </span><span class="com">//if (/[NS]/i.test(dmsStr)) deg = '0' + deg;  // - normalise N/S to 3-digit degrees</span><span class="pln">
            </span><span class="com">//if (/[0-9]{7}/.test(deg)) deg = deg.slice(0,3)/1 + deg.slice(3,5)/60 + deg.slice(5)/3600;</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">default</span><span class="pun">:</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">NaN</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="str">/^-|[WS]$/</span><span class="pln">i</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">dmsStr</span><span class="pun">.</span><span class="pln">trim</span><span class="pun">()))</span><span class="pln"> deg </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">deg</span><span class="pun">;</span><span class="pln"> </span><span class="com">// take '-', west and south as -ve</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Number</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">);</span><span class="pln">
</span><span class="pun">};</span><span class="pln">


</span><span class="com">/**
 * Converts decimal degrees to deg/min/sec format
 *  - degree, prime, double-prime symbols are added, but sign is discarded, though no compass
 *    direction is added.
 *
 * @private
 * @param   {number} deg - Degrees to be formatted as specified.
 * @param   {string} [format=dms] - Return value as 'd', 'dm', 'dms' for deg, deg+min, deg+min+sec.
 * @param   {number} [dp=0|2|4] - Number of decimal places to use – default 0 for dms, 2 for dm, 4 for d.
 * @returns {string} Degrees formatted as deg/min/secs according to specified format.
 */</span><span class="pln">
</span><span class="typ">Dms</span><span class="pun">.</span><span class="pln">toDMS </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">,</span><span class="pln"> format</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isNaN</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">))</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">  </span><span class="com">// give up here if we can't make a number from deg</span><span class="pln">

    </span><span class="com">// default values</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">format </span><span class="pun">===</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">)</span><span class="pln"> format </span><span class="pun">=</span><span class="pln"> </span><span class="str">'dms'</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dp </span><span class="pun">===</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">format</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">:</span><span class="pln">    </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'deg'</span><span class="pun">:</span><span class="pln">         dp </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'dm'</span><span class="pun">:</span><span class="pln">   </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'deg+min'</span><span class="pun">:</span><span class="pln">     dp </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'dms'</span><span class="pun">:</span><span class="pln">  </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'deg+min+sec'</span><span class="pun">:</span><span class="pln"> dp </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">default</span><span class="pun">:</span><span class="pln">    format </span><span class="pun">=</span><span class="pln"> </span><span class="str">'dms'</span><span class="pun">;</span><span class="pln"> dp </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">  </span><span class="com">// be forgiving on invalid format</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    deg </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">);</span><span class="pln">  </span><span class="com">// (unsigned result ready for appending compass dir'n)</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> dms</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">format</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">default</span><span class="pun">:</span><span class="pln"> </span><span class="com">// invalid format spec!</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'deg'</span><span class="pun">:</span><span class="pln">
            d </span><span class="pun">=</span><span class="pln"> deg</span><span class="pun">.</span><span class="pln">toFixed</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">);</span><span class="pln">    </span><span class="com">// round degrees</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">&lt;</span><span class="lit">100</span><span class="pun">)</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="str">'0'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">;</span><span class="pln"> </span><span class="com">// pad with leading zeros</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">&lt;</span><span class="lit">10</span><span class="pun">)</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="str">'0'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">;</span><span class="pln">
            dms </span><span class="pun">=</span><span class="pln"> d </span><span class="pun">+</span><span class="pln"> </span><span class="str">'°'</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'dm'</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'deg+min'</span><span class="pun">:</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> min </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">deg</span><span class="pun">*</span><span class="lit">60</span><span class="pun">).</span><span class="pln">toFixed</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">);</span><span class="pln"> </span><span class="com">// convert degrees to minutes &amp; round</span><span class="pln">
            d </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">floor</span><span class="pun">(</span><span class="pln">min </span><span class="pun">/</span><span class="pln"> </span><span class="lit">60</span><span class="pun">);</span><span class="pln">       </span><span class="com">// get component deg/min</span><span class="pln">
            m </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">min </span><span class="pun">%</span><span class="pln"> </span><span class="lit">60</span><span class="pun">).</span><span class="pln">toFixed</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">);</span><span class="pln">     </span><span class="com">// pad with trailing zeros</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">&lt;</span><span class="lit">100</span><span class="pun">)</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="str">'0'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">;</span><span class="pln">         </span><span class="com">// pad with leading zeros</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">&lt;</span><span class="lit">10</span><span class="pun">)</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="str">'0'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m</span><span class="pun">&lt;</span><span class="lit">10</span><span class="pun">)</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> </span><span class="str">'0'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
            dms </span><span class="pun">=</span><span class="pln"> d </span><span class="pun">+</span><span class="pln"> </span><span class="str">'°'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> m </span><span class="pun">+</span><span class="pln"> </span><span class="str">'′'</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'dms'</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'deg+min+sec'</span><span class="pun">:</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> sec </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">deg</span><span class="pun">*</span><span class="lit">3600</span><span class="pun">).</span><span class="pln">toFixed</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">);</span><span class="pln"> </span><span class="com">// convert degrees to seconds &amp; round</span><span class="pln">
            d </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">floor</span><span class="pun">(</span><span class="pln">sec </span><span class="pun">/</span><span class="pln"> </span><span class="lit">3600</span><span class="pun">);</span><span class="pln">       </span><span class="com">// get component deg/min/sec</span><span class="pln">
            m </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">floor</span><span class="pun">(</span><span class="pln">sec</span><span class="pun">/</span><span class="lit">60</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">60</span><span class="pun">;</span><span class="pln">
            s </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sec </span><span class="pun">%</span><span class="pln"> </span><span class="lit">60</span><span class="pun">).</span><span class="pln">toFixed</span><span class="pun">(</span><span class="pln">dp</span><span class="pun">);</span><span class="pln">       </span><span class="com">// pad with trailing zeros</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">&lt;</span><span class="lit">100</span><span class="pun">)</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="str">'0'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">;</span><span class="pln">           </span><span class="com">// pad with leading zeros</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">&lt;</span><span class="lit">10</span><span class="pun">)</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="str">'0'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> d</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m</span><span class="pun">&lt;</span><span class="lit">10</span><span class="pun">)</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> </span><span class="str">'0'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">s</span><span class="pun">&lt;</span><span class="lit">10</span><span class="pun">)</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="str">'0'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> s</span><span class="pun">;</span><span class="pln">
            dms </span><span class="pun">=</span><span class="pln"> d </span><span class="pun">+</span><span class="pln"> </span><span class="str">'°'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> m </span><span class="pun">+</span><span class="pln"> </span><span class="str">'′'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> s </span><span class="pun">+</span><span class="pln"> </span><span class="str">'″'</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> dms</span><span class="pun">;</span><span class="pln">
</span><span class="pun">};</span><span class="pln">


</span><span class="com">/**
 * Converts numeric degrees to deg/min/sec latitude (2-digit degrees, suffixed with N/S).
 *
 * @param   {number} deg - Degrees to be formatted as specified.
 * @param   {string} [format=dms] - Return value as 'd', 'dm', 'dms' for deg, deg+min, deg+min+sec.
 * @param   {number} [dp=0|2|4] - Number of decimal places to use – default 0 for dms, 2 for dm, 4 for d.
 * @returns {string} Degrees formatted as deg/min/secs according to specified format.
 */</span><span class="pln">
</span><span class="typ">Dms</span><span class="pun">.</span><span class="pln">toLat </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">,</span><span class="pln"> format</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> lat </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Dms</span><span class="pun">.</span><span class="pln">toDMS</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">,</span><span class="pln"> format</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> lat</span><span class="pun">===</span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'–'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> lat</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">deg</span><span class="pun">&lt;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'S'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'N'</span><span class="pun">);</span><span class="pln">  </span><span class="com">// knock off initial '0' for lat!</span><span class="pln">
</span><span class="pun">};</span><span class="pln">


</span><span class="com">/**
 * Convert numeric degrees to deg/min/sec longitude (3-digit degrees, suffixed with E/W)
 *
 * @param   {number} deg - Degrees to be formatted as specified.
 * @param   {string} [format=dms] - Return value as 'd', 'dm', 'dms' for deg, deg+min, deg+min+sec.
 * @param   {number} [dp=0|2|4] - Number of decimal places to use – default 0 for dms, 2 for dm, 4 for d.
 * @returns {string} Degrees formatted as deg/min/secs according to specified format.
 */</span><span class="pln">
</span><span class="typ">Dms</span><span class="pun">.</span><span class="pln">toLon </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">,</span><span class="pln"> format</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> lon </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Dms</span><span class="pun">.</span><span class="pln">toDMS</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">,</span><span class="pln"> format</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> lon</span><span class="pun">===</span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'–'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> lon </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">deg</span><span class="pun">&lt;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'W'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'E'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">};</span><span class="pln">


</span><span class="com">/**
 * Converts numeric degrees to deg/min/sec as a bearing (0°..360°)
 *
 * @param   {number} deg - Degrees to be formatted as specified.
 * @param   {string} [format=dms] - Return value as 'd', 'dm', 'dms' for deg, deg+min, deg+min+sec.
 * @param   {number} [dp=0|2|4] - Number of decimal places to use – default 0 for dms, 2 for dm, 4 for d.
 * @returns {string} Degrees formatted as deg/min/secs according to specified format.
 */</span><span class="pln">
</span><span class="typ">Dms</span><span class="pun">.</span><span class="pln">toBrng </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">,</span><span class="pln"> format</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    deg </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">)+</span><span class="lit">360</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">360</span><span class="pun">;</span><span class="pln">  </span><span class="com">// normalise -ve values to 180°..360°</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> brng </span><span class="pun">=</span><span class="pln">  </span><span class="typ">Dms</span><span class="pun">.</span><span class="pln">toDMS</span><span class="pun">(</span><span class="pln">deg</span><span class="pun">,</span><span class="pln"> format</span><span class="pun">,</span><span class="pln"> dp</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> brng</span><span class="pun">===</span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'–'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> brng</span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="str">'360'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'0'</span><span class="pun">);</span><span class="pln">  </span><span class="com">// just in case rounding took us up to 360°!</span><span class="pln">
</span><span class="pun">};</span><span class="pln">


</span><span class="com">/**
 * Returns compass point (to given precision) for supplied bearing.
 *
 * @param   {number} bearing - Bearing in degrees from north.
 * @param   {number} [precision=3] - Precision (cardinal / intercardinal / secondary-intercardinal).
 * @returns {string} Compass point for supplied bearing.
 *
 * @example
 *   var point = Dms.compassPoint(24);    // point = 'NNE'
 *   var point = Dms.compassPoint(24, 1); // point = 'N'
 */</span><span class="pln">
</span><span class="typ">Dms</span><span class="pun">.</span><span class="pln">compassPoint </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">bearing</span><span class="pun">,</span><span class="pln"> precision</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">precision </span><span class="pun">===</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">)</span><span class="pln"> precision </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln">
    </span><span class="com">// note precision = max length of compass point; it could be extended to 4 for quarter-winds</span><span class="pln">
    </span><span class="com">// (eg NEbN), but I think they are little used</span><span class="pln">

    bearing </span><span class="pun">=</span><span class="pln"> </span><span class="pun">((</span><span class="pln">bearing</span><span class="pun">%</span><span class="lit">360</span><span class="pun">)+</span><span class="lit">360</span><span class="pun">)%</span><span class="lit">360</span><span class="pun">;</span><span class="pln"> </span><span class="com">// normalise to 0..360</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> point</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">precision</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="com">// 4 compass points</span><span class="pln">
            </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">round</span><span class="pun">(</span><span class="pln">bearing</span><span class="pun">*</span><span class="lit">4</span><span class="pun">/</span><span class="lit">360</span><span class="pun">)%</span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'N'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'E'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'S'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'W'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> </span><span class="com">// 8 compass points</span><span class="pln">
            </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">round</span><span class="pun">(</span><span class="pln">bearing</span><span class="pun">*</span><span class="lit">8</span><span class="pun">/</span><span class="lit">360</span><span class="pun">)%</span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'N'</span><span class="pun">;</span><span class="pln">  </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'NE'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'E'</span><span class="pun">;</span><span class="pln">  </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SE'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">4</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'S'</span><span class="pun">;</span><span class="pln">  </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">5</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SW'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">6</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'W'</span><span class="pun">;</span><span class="pln">  </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">7</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'NW'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> </span><span class="com">// 16 compass points</span><span class="pln">
            </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">round</span><span class="pun">(</span><span class="pln">bearing</span><span class="pun">*</span><span class="lit">16</span><span class="pun">/</span><span class="lit">360</span><span class="pun">)%</span><span class="lit">16</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln">  </span><span class="lit">0</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'N'</span><span class="pun">;</span><span class="pln">   </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln">  </span><span class="lit">1</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'NNE'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln">  </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'NE'</span><span class="pun">;</span><span class="pln">  </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln">  </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'ENE'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln">  </span><span class="lit">4</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'E'</span><span class="pun">;</span><span class="pln">   </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln">  </span><span class="lit">5</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'ESE'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln">  </span><span class="lit">6</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SE'</span><span class="pun">;</span><span class="pln">  </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln">  </span><span class="lit">7</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SSE'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln">  </span><span class="lit">8</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'S'</span><span class="pun">;</span><span class="pln">   </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln">  </span><span class="lit">9</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SSW'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">10</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SW'</span><span class="pun">;</span><span class="pln">  </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">11</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'WSW'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">12</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'W'</span><span class="pun">;</span><span class="pln">   </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'WNW'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">14</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'NW'</span><span class="pun">;</span><span class="pln">  </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">15</span><span class="pun">:</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="str">'NNW'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">default</span><span class="pun">:</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RangeError</span><span class="pun">(</span><span class="str">'Precision must be between 1 and 3'</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> point</span><span class="pun">;</span><span class="pln">
</span><span class="pun">};</span><span class="pln">


</span><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span><span class="pln">


</span><span class="com">/** Polyfill String.trim for old browsers
 *  (q.v. blog.stevenlevithan.com/archives/faster-trim-javascript) */</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">.</span><span class="pln">trim </span><span class="pun">===</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">.</span><span class="pln">trim </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">String</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">).</span><span class="pln">replace</span><span class="pun">(</span><span class="str">/^\s\s*/</span><span class="pun">,</span><span class="pln"> </span><span class="str">''</span><span class="pun">).</span><span class="pln">replace</span><span class="pun">(</span><span class="str">/\s\s*$/</span><span class="pun">,</span><span class="pln"> </span><span class="str">''</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span><span class="com">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">typeof</span><span class="pln"> </span><span class="kwd">module</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">'undefined'</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Dms</span><span class="pun">;</span><span class="pln"> </span><span class="com">// CommonJS (Node)</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">typeof</span><span class="pln"> define </span><span class="pun">==</span><span class="pln"> </span><span class="str">'function'</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> define</span><span class="pun">.</span><span class="pln">amd</span><span class="pun">)</span><span class="pln"> define</span><span class="pun">([],</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Dms</span><span class="pun">;</span><span class="pln"> </span><span class="pun">});</span><span class="pln"> </span><span class="com">// AMD</span></pre>

<!--[if lte IE 8]> <p>If IE8-, gets confused about line endings, you can view source at
    <a href="https://github.com/chrisveness/geodesy/blob/master/latlon.js">GitHub</a></p> <![endif]-->

<!-- 2012-10-07: phi, lambda for lat, lon -->
<!-- 2014-04-27: greek letters throughout, Gudermannian -->
<!-- 2014-06-27: rationalised script (all within listeners) -->


</body></html>